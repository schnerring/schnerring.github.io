<!doctype html><html lang=en data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload as=font type=font/woff2 href=/fonts/roboto-slab-latin-400.woff2 crossorigin=anonymous><link rel=prefetch as=font type=font/woff2 href=/fonts/roboto-slab-latin-700.woff2 crossorigin=anonymous><link rel=preload as=font type=font/woff2 href=/fonts/fira-code-latin-300.woff2 crossorigin=anonymous><link rel=preload as=font type=font/woff2 href=/fonts/fira-code-latin-400.woff2 crossorigin=anonymous><link rel=prefetch as=font type=font/woff2 href=/fonts/fira-code-latin-700.woff2 crossorigin=anonymous><meta name=robots content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Set Up Azure Active Directory Domain Services (AADDS) with Terraform</title><meta name=description content="Update 2022-02-20# This guide is outdated! Please click here to go to the new guide I wrote.
"><link rel=canonical href=https://schnerring.net/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://schnerring.net/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover.jpg"><meta name=twitter:title content="Set Up Azure Active Directory Domain Services (AADDS) with Terraform"><meta name=twitter:description content="Update 2022-02-20#

This guide is outdated! Please click here to go to the new guide I wrote."><meta property="og:title" content="Set Up Azure Active Directory Domain Services (AADDS) with Terraform"><meta property="og:description" content="Update 2022-02-20#

This guide is outdated! Please click here to go to the new guide I wrote."><meta property="og:type" content="article"><meta property="og:url" content="https://schnerring.net/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/"><meta property="og:image" content="https://schnerring.net/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover.jpg"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-05-22T16:23:36+02:00"><meta property="article:modified_time" content="2021-05-22T16:23:36+02:00"><meta itemprop=name content="Set Up Azure Active Directory Domain Services (AADDS) with Terraform"><meta itemprop=description content="Update 2022-02-20#

This guide is outdated! Please click here to go to the new guide I wrote."><meta itemprop=datePublished content="2021-05-22T16:23:36+02:00"><meta itemprop=dateModified content="2021-05-22T16:23:36+02:00"><meta itemprop=wordCount content="1114"><meta itemprop=image content="https://schnerring.net/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover.jpg"><meta itemprop=keywords content="AADDS,ARM,Azure,Azure Active Directory Domain Services,Azure Resource Manager Template,Cloud,IaC,Infrastructure as Code,Terraform,"><script async defer data-domain=schnerring.net src=https://plausible.schnerring.net/js/plausible.js></script><style>@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:100;src:local("Roboto Slab Thin "),local("Roboto Slab-Thin"),url(/fonts/roboto-slab-latin-100.woff2) format("woff2"),url(/fonts/roboto-slab-latin-100.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:200;src:local("Roboto Slab Extra Light "),local("Roboto Slab-Extra Light"),url(/fonts/roboto-slab-latin-200.woff2) format("woff2"),url(/fonts/roboto-slab-latin-200.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:300;src:local("Roboto Slab Light "),local("Roboto Slab-Light"),url(/fonts/roboto-slab-latin-300.woff2) format("woff2"),url(/fonts/roboto-slab-latin-300.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:400;src:local("Roboto Slab Regular "),local("Roboto Slab-Regular"),url(/fonts/roboto-slab-latin-400.woff2) format("woff2"),url(/fonts/roboto-slab-latin-400.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:500;src:local("Roboto Slab Medium "),local("Roboto Slab-Medium"),url(/fonts/roboto-slab-latin-500.woff2) format("woff2"),url(/fonts/roboto-slab-latin-500.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:600;src:local("Roboto Slab SemiBold "),local("Roboto Slab-SemiBold"),url(/fonts/roboto-slab-latin-600.woff2) format("woff2"),url(/fonts/roboto-slab-latin-600.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:700;src:local("Roboto Slab Bold "),local("Roboto Slab-Bold"),url(/fonts/roboto-slab-latin-700.woff2) format("woff2"),url(/fonts/roboto-slab-latin-700.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:800;src:local("Roboto Slab ExtraBold "),local("Roboto Slab-ExtraBold"),url(/fonts/roboto-slab-latin-800.woff2) format("woff2"),url(/fonts/roboto-slab-latin-800.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:900;src:local("Roboto Slab Black "),local("Roboto Slab-Black"),url(/fonts/roboto-slab-latin-900.woff2) format("woff2"),url(/fonts/roboto-slab-latin-900.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:300;src:local("Fira Code Light "),local("Fira Code-Light"),url(/fonts/fira-code-latin-300.woff2) format("woff2"),url(/fonts/fira-code-latin-300.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:400;src:local("Fira Code Regular "),local("Fira Code-Regular"),url(/fonts/fira-code-latin-400.woff2) format("woff2"),url(/fonts/fira-code-latin-400.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:500;src:local("Fira Code Medium "),local("Fira Code-Medium"),url(/fonts/fira-code-latin-500.woff2) format("woff2"),url(/fonts/fira-code-latin-500.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:600;src:local("Fira Code SemiBold "),local("Fira Code-SemiBold"),url(/fonts/fira-code-latin-600.woff2) format("woff2"),url(/fonts/fira-code-latin-600.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:700;src:local("Fira Code Bold "),local("Fira Code-Bold"),url(/fonts/fira-code-latin-700.woff2) format("woff2"),url(/fonts/fira-code-latin-700.woff) format("woff")}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}

/*! Source: https://stackoverflow.com/a/36118384/1154965 */@keyframes blink{50%{opacity:0}to{opacity:1}}

/*! MIT License | github.com/schnerring/hugo-theme-gruvbox */:root[data-theme=light]{--bg:var(--bg0_h);--bg0:#fbf1c7;--bg0_h:#f9f5d7;--bg0_s:#f2e5bc;--bg1:#ebdbb2;--bg2:#d5c4a1;--bg3:#bdae93;--bg4:#a89984;--fg:var(--fg1);--fg0:#282828;--fg1:#3c3836;--fg2:#504945;--fg3:#665c54;--fg4:#7c6f64;--gray1:var(--fg4);--gray2:#928374;--red1:#cc241d;--red2:#9d0006;--green1:#98971a;--green2:#797403;--yellow1:#d79921;--yellow2:#b57614;--blue1:#458588;--blue2:#076678;--purple1:#b16286;--purple2:#8f3f71;--aqua1:#689d6a;--aqua2:#427b58;--orange1:#d65d0e;--orange2:#af3a03}[data-theme=light]:root .light--hidden{display:none}:root[data-theme=dark]{--bg:var(--bg0_h);--bg0:#282828;--bg0_h:#1d2021;--bg0_s:#32302f;--bg1:#3c3836;--bg2:#504945;--bg3:#665c54;--bg4:#7c6f64;--fg:var(--fg1);--fg0:#fbf1c7;--fg1:#ebdbb2;--fg2:#d5c4a1;--fg3:#bdae93;--fg4:#a89984;--gray1:var(--fg4);--gray2:#928374;--red1:#cc241d;--red2:#fb4934;--green1:#98971a;--green2:#b8bb26;--yellow1:#d79921;--yellow2:#fabd2f;--blue1:#458588;--blue2:#83a598;--purple1:#b16286;--purple2:#d3869b;--aqua1:#689d6a;--aqua2:#8ec07c;--orange1:#d65d0e;--orange2:#fe8019}[data-theme=dark]:root .dark--hidden{display:none}:root{--primary:var(--aqua1);--primary-alt:var(--aqua2);--font-monospace:"Fira Code","Lucida Console",Monaco,monospace;--font-sans-serif:Verdana,Helvetica,sans-serif;--font-serif:"Roboto Slab",Georgia,serif}html{font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);font-size:1rem;scroll-behavior:smooth}body{word-wrap:break-word;background:var(--bg);color:var(--fg);line-height:1.675}strong{letter-spacing:.35px}a{color:inherit;-webkit-text-decoration:none;text-decoration:none}a.link--external:after{content:"\2009↗"}img,video{border:2px solid var(--bg1);height:auto;max-width:100%}figure{display:inline-block}figcaption{color:var(--fg3);font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);font-size:.9rem}::-moz-selection{background:var(--bg4);color:var(--fg0)}::selection{background:var(--bg4);color:var(--fg0)}h1,h2,h3,h4,h5{color:var(--fg0);font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);font-weight:300;line-height:1.4}h1 code,h2 code,h3 code,h4 code,h5 code{font-size:1em}h2,h3,h4,h5{border-bottom:1px solid var(--bg1)}h1,h2{font-weight:400}h1{font-size:1.875rem}h2{font-size:1.75rem}h3{font-size:1.625rem}@media (min-width:768px){h1{font-size:2.375rem}h2{font-size:2rem}h3{font-size:1.75rem}}h4{font-size:1.5rem}h5{font-size:1.375rem}table{border-collapse:collapse;margin:2rem 0;table-layout:fixed;width:100%}table,td,th{border:1px solid var(--bg1);padding:.5rem}hr{background:var(--bg1);border:none;height:1px;margin:3rem auto;width:80%}blockquote,code,pre{border-radius:.2rem;padding:0 .2em}pre code{padding:0}blockquote,code,pre,th{background:var(--bg1)}code,pre,th{font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace)}code code{background:var(--bg2)}blockquote,pre{padding:1rem}pre{background:var(--bg1)!important;overflow:auto}pre code{background:none}blockquote{border-left:5px solid var(--primary-alt);margin:.5rem 0}blockquote:not(.does-not-exist) code{background:var(--bg2)}blockquote:not(.does-not-exist) p:first-of-type{margin-top:0}blockquote:not(.does-not-exist) p:last-of-type{margin-bottom:0}pre::-webkit-scrollbar{height:.5rem;scrollbar-width:auto}pre::-webkit-scrollbar-track{background:var(--bg2);border-radius:.2rem}pre::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:.2rem}.layout{display:grid;grid-template-areas:"header" "main" "footer";grid-template-rows:auto 1fr auto;height:100vh}main{align-items:start;display:grid;grid-area:main;grid-template-areas:"empty content sidebar";grid-template-columns:1fr minmax(0,650px) 4fr}header{background:var(--bg1);grid-area:header}footer{grid-area:footer}footer,main{margin:.5em 1.1em}.content{grid-area:content}.sidebar{display:none;flex-direction:column;grid-area:sidebar;margin-top:3rem;position:sticky;top:2rem}@media (min-width:992px){.sidebar{display:flex}}header{display:grid;font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);font-size:1.125rem;grid-template-areas:"heading search nav theme-toggle";grid-template-columns:auto auto 1fr auto;padding:.75rem}.logo{color:var(--fg0);display:flex;font-weight:700;grid-area:heading}.logo:hover .logo__cursor{animation:blink 1s infinite;opacity:1}.logo__chevron,.logo__cursor{margin-left:.5rem}.logo__cursor{opacity:0}.logo__text{display:none}@media (min-width:768px){.logo__text{display:block}}.search{display:flex;grid-area:search;margin:0 1rem}#search__text{background:var(--bg2);border:1px solid var(--bg2);border-radius:.2rem;caret-color:var(--fg);color:var(--fg);outline:none;padding:0 .5rem;width:100%}#search__text:hover{border-color:var(--bg3)}#search__text:focus{border-color:var(--bg4)}#search__text::-moz-placeholder{color:var(--fg3)}#search__text::placeholder{color:var(--fg3)}#search__text[type=search]::-webkit-search-cancel-button{-webkit-appearance:none;appearance:none}#search__suggestions{background:var(--bg);border-radius:.2rem;box-shadow:0 .5rem 1rem var(--bg1);font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);left:0;margin-top:2rem;position:absolute;width:95vw;z-index:1000}@media (min-width:768px){.search{position:relative}#search__suggestions{width:60vw}}.search__suggestions--hidden{display:none}.search__suggestion-item{border-bottom:1px dashed var(--bg2);display:grid;grid-template-columns:1fr 2fr}.search__suggestion-item:focus,.search__suggestion-item:focus-visible,.search__suggestion-item:hover{background:var(--bg1);cursor:pointer;outline:none}.search__suggestion-item:last-child{border:none}.search__suggestion-description,.search__suggestion-title{margin:1rem 0;padding:0 1rem}.search__suggestion-title{font-weight:700}.search__suggestion-description{border-left:1px solid var(--bg2)}.search__no-results{padding:.75rem}.theme__toggle{align-items:center;background:none;border:none;color:var(--yellow1);cursor:pointer;display:flex;grid-area:theme-toggle;margin:0 1rem}.theme__toggle:hover{color:var(--yellow2)}.theme__toggle svg{height:28px;width:28px}nav#menu{align-items:center;display:flex;grid-area:nav;justify-content:flex-end}nav#menu .menu__item{color:var(--fg)}nav#menu .menu__item:hover{color:var(--fg3);cursor:pointer}nav#menu ul{list-style:none;margin:0;padding:0}nav#menu ul.menu--horizontal{align-items:center;display:none}nav#menu ul.menu--horizontal li{display:inline-block;margin:0 .75rem}@media (min-width:768px){nav#menu ul.menu--horizontal{display:flex}}nav#menu ul.menu--vertical{background:var(--fg0);bottom:0;margin:0;padding:3rem;position:fixed;right:0;top:0;transform:translate(100%);transition:transform .5s cubic-bezier(.9,0,.1,1);width:50%;z-index:10}nav#menu ul.menu--vertical .menu__item{color:var(--bg1)}nav#menu ul.menu--vertical .menu__item:hover{color:var(--bg4)}nav#menu .menu__burger{display:flex;height:24px;width:24px}nav#menu .menu__burger>*{position:absolute}nav#menu .menu__burger svg{height:inherit;width:inherit;z-index:20}nav#menu .menu__burger svg line{transition-duration:.5s;transition-property:stroke,opacity,transform;transition-timing-function:cubic-bezier(.9,0,.1,1)}nav#menu .menu__burger svg line:first-of-type{transform-origin:center 6px}nav#menu .menu__burger svg line:nth-of-type(2){transform-origin:center 12px}nav#menu .menu__burger svg line:nth-of-type(3){transform-origin:center 18px}nav#menu .menu__burger input{height:inherit;opacity:0;width:inherit;z-index:30}:is(nav#menu .menu__burger input:checked)~ul.menu--vertical{transform:none}:is(nav#menu .menu__burger input:checked)~svg{stroke:var(--bg1)}:is(nav#menu .menu__burger input:checked)~svg line:first-of-type{transform:translateY(6px) rotate(45deg)}:is(nav#menu .menu__burger input:checked)~svg line:nth-of-type(2){opacity:0;transform:scale(.2)}:is(nav#menu .menu__burger input:checked)~svg line:nth-of-type(3){transform:translateY(-6px) rotate(-45deg)}@media (min-width:768px){nav#menu .menu__burger{display:none}}.sidebar{font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);margin-left:auto;margin-right:auto;max-width:350px;padding-left:2.5rem}.sidebar svg{fill:var(--fg)}.sidebar__heading{font-size:1.3rem}aside.toc a{color:var(--aqua2);color:var(--primary-alt)}aside.toc a:hover{color:var(--aqua1);color:var(--primary)}aside.toc ul{list-style:none;margin:0;padding:0}aside.toc ul ul{font-size:.9rem;margin-left:.5rem}aside.toc ul li{line-height:1.1}aside.toc ul li a{display:block;padding:.2rem 0}.jr-basics__image{background:var(--bg1);border:2px solid var(--bg2)}.jr-basics__summary{color:var(--fg3);font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);margin:.75rem 0}.jr-basics__profile a:hover{color:var(--fg3)}.jr-basics__profile a:hover svg{fill:var(--fg3)}.post{border-bottom:2px dotted var(--bg1);padding:2rem 0}.post figure,.post img:not(figure img),.post video:not(figure video){box-sizing:border-box;margin:.5rem 0}.post-content__read-more,.post-header{font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace)}.post-content{margin:1.3rem 0}.post-content__read-more{margin-top:1.3rem}.post-content a,.post-content__read-more,.post-header a{color:var(--aqua2);color:var(--primary-alt)}.post-content a:hover,.post-header a:hover{color:var(--aqua1);color:var(--primary)}.post-tags{align-items:center;display:flex;flex-wrap:wrap;gap:.9rem;margin:1rem 0}.post-tag{font-size:.9rem;line-height:1}.post-tag:before{content:"#"}.post-heading__anchor{display:none}h1:hover .post-heading__anchor,h2:hover .post-heading__anchor,h3:hover .post-heading__anchor,h4:hover .post-heading__anchor,h5:hover .post-heading__anchor{display:inline-block}.jr__item-meta{flex-direction:column}.jr-basics__image,.jr-basics__item,.jr-basics__profile-icon,.jr-basics__profile-item,.jr__item-meta{align-items:center;display:flex}.jr-basics__name,.jr-projects__roles,.jr-work__position{font-size:1.125rem;font-weight:700}.jr-basics__item{flex-direction:column;text-align:center}.jr-basics__item hr{margin:1.5rem auto}.jr-basics__image{border-radius:50%;height:250px;justify-content:center;overflow:hidden;width:250px}.jr-basics__label,.jr-basics__name,.jr-basics__summary{margin-top:.75rem}.jr-basics__profile svg{height:24px;width:24px}.jr-basics__profile,.jr-basics__profile-item{display:flex}.jr-basics__profile-item{display:flex;padding:.2rem}.jr-basics__profile--row{flex-wrap:wrap;justify-content:space-evenly}.jr-basics__profile-icon{padding:0 .75rem}.jr__item-meta{align-items:start;flex-flow:column;font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace)}@media (min-width:768px){.jr__item-meta{align-items:center;flex-flow:row wrap}.jr-work__location,.jr__date-range{flex-grow:1;text-align:right}}#cookie-consent{animation:fadeIn .75s;background:var(--fg0);border-radius:.2rem;bottom:1rem;box-shadow:0 -.5rem 1rem var(--bg1);color:var(--bg1);font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);left:1rem;padding:1rem;position:fixed;right:1rem;z-index:2000}@media (min-width:768px){#cookie-consent{padding:2.5rem}}#cookie-consent button{background:none;border:none;color:var(--aqua1);color:var(--primary);font-size:1.125rem;margin:0 1rem;white-space:nowrap}#cookie-consent button:hover{color:var(--aqua2);color:var(--primary-alt);cursor:pointer}.cookie-consent--hidden{display:none}.cli-prompt{display:flex;justify-content:center}.cli-prompt__cursor{animation:blink 1s infinite}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.social-share{align-items:center;border-top:2px dotted var(--bg1);display:flex;flex-wrap:wrap;gap:.9rem;margin:3rem 0;padding-top:3rem}.social-share svg{fill:var(--fg);height:24px;width:24px}.social-share svg.icon-tabler{fill:none;stroke:var(--fg)}.social-share__item{background:var(--bg1);display:flex;padding:.5rem}</style><link rel=preload href="/css/non-critical.713869c4c9bcaee5df59301fd32a5d831bdcc701104d142e54e1da442b7b0ed98ab0037e053dce4e3c73ef9b86b2e4d1cecf4444414cce6dc9e979de548736e0.css" as=style onload='this.onload=null,this.rel="stylesheet"' integrity="sha512-cThpxMm8ruXfWTAf0ypdgxvcxwEQTRQuVOHaRCt7DtmKsAN+BT3OTjxz75uGsuTRzs9EREFMzm3J6XneVIc24A=="><link id=prism-dark rel=prefetch href=/prism-themes/prism-gruvbox-dark.min.54aecc64074623a4f9898544dcbdab9e804f1560ef0b38f4cf8e10fcaaf72264e798cb407c601aca6ecd833ec4eb93d66535581f18d45ba202cf848b70dbc332.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity="sha512-VK7MZAdGI6T5iYVE3L2rnoBPFWDvCzj0z44Q/Kr3ImTnmMtAfGAaym7Ngz7E65PWZTVYHxjUW6ICz4SLcNvDMg=="><link id=prism-light rel=prefetch href=/prism-themes/prism-gruvbox-light.min.42a221741efe997fcc94187c39d63c555560678789ac9ca856c74a5f0ddb2aa6c50d38b2ffbecc7a99038cbbd2efa99746e862267f781c559e0cfec10b88a5fc.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity="sha512-QqIhdB7+mX/MlBh8OdY8VVVgZ4eJrJyoVsdKXw3bKqbFDTiy/77MepkDjLvS76mXRuhiJn94HFWeDP7BC4il/A==" disabled><noscript><link rel=stylesheet href=/prism-themes/prism-gruvbox-dark.min.54aecc64074623a4f9898544dcbdab9e804f1560ef0b38f4cf8e10fcaaf72264e798cb407c601aca6ecd833ec4eb93d66535581f18d45ba202cf848b70dbc332.css integrity="sha512-VK7MZAdGI6T5iYVE3L2rnoBPFWDvCzj0z44Q/Kr3ImTnmMtAfGAaym7Ngz7E65PWZTVYHxjUW6ICz4SLcNvDMg=="><link rel=stylesheet href="/css/non-critical.713869c4c9bcaee5df59301fd32a5d831bdcc701104d142e54e1da442b7b0ed98ab0037e053dce4e3c73ef9b86b2e4d1cecf4444414cce6dc9e979de548736e0.css" integrity="sha512-cThpxMm8ruXfWTAf0ypdgxvcxwEQTRQuVOHaRCt7DtmKsAN+BT3OTjxz75uGsuTRzs9EREFMzm3J6XneVIc24A=="></noscript><script>(()=>{function n(){if(localStorage&&localStorage.getItem("theme"))return localStorage.getItem("theme");if(window.matchMedia)return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}function e(e){document.documentElement.setAttribute("data-theme",e);let t=document.getElementById("prism-dark"),n=document.getElementById("prism-light");t.toggleAttribute("disabled",e==="light"),n.toggleAttribute("disabled",e==="dark"),localStorage.setItem("theme",e)}var t=n();t&&e(t);function s(t){let n=t.currentTarget.classList.contains("light--hidden")?"light":"dark";e(n)}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".theme__toggle").forEach(e=>{e.addEventListener("click",s)})})})()</script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#282828"><meta name=theme-color content="#282828"></head><body><div class=layout><header><a class=logo href=/><div class=logo__text>schnerring.net</div><div class=logo__chevron>></div><div class=logo__cursor>█</div></a><div class=search><input id=search__text type=search placeholder=Search... aria-label=Search autocomplete=off><div id=search__suggestions class=search__suggestions--hidden></div></div><nav id=menu><ul class=menu--horizontal><li class=menu__item><a href=/blog>Blog</a></li><li class=menu__item><a href=/projects>Projects</a></li><li class=menu__item><a href=/about>About</a></li><li class=menu__item><a href=/stats>Stats</a></li></ul><div class=menu__burger><input class=menu__item type=checkbox aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 6h16"/><path d="M4 12h16"/><path d="M4 18h16"/></svg><ul class=menu--vertical><li><a class=menu__item href=/blog>Blog</a></li><li><a class=menu__item href=/projects>Projects</a></li><li><a class=menu__item href=/about>About</a></li><li><a class=menu__item href=/stats>Stats</a></li></ul></div></nav><button class="theme__toggle light--hidden" aria-label="Toggle light mode"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button>
<button class="theme__toggle dark--hidden" aria-label="Toggle dark mode"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg></button></header><main><div class=content><article class=post><div class=post-header><h1><a href=/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/>Set Up Azure Active Directory Domain Services (AADDS) with Terraform</a></h1><div class=post-meta><span>2021-05-22</span><div class=post-tags><a class=post-tag href=https://schnerring.net/tags/aadds>aadds</a><a class=post-tag href=https://schnerring.net/tags/arm>arm</a><a class=post-tag href=https://schnerring.net/tags/azure>azure</a><a class=post-tag href=https://schnerring.net/tags/azure-active-directory-domain-services>azure&#8209;active&#8209;directory&#8209;domain&#8209;services</a><a class=post-tag href=https://schnerring.net/tags/azure-resource-manager-template>azure&#8209;resource&#8209;manager&#8209;template</a><a class=post-tag href=https://schnerring.net/tags/cloud>cloud</a><a class=post-tag href=https://schnerring.net/tags/iac>iac</a><a class=post-tag href=https://schnerring.net/tags/infrastructure-as-code>infrastructure&#8209;as&#8209;code</a><a class=post-tag href=https://schnerring.net/tags/terraform>terraform</a></div><picture><source type=image/webp srcset="/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover_hu22b9c7fce07d9deac9cf6b4d56786935_44448_300x0_resize_q90_h2_box.webp 300w,/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover_hu22b9c7fce07d9deac9cf6b4d56786935_44448_400x0_resize_q90_h2_box.webp 400w,/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover_hu22b9c7fce07d9deac9cf6b4d56786935_44448_500x0_resize_q90_h2_box.webp 500w,/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover_hu22b9c7fce07d9deac9cf6b4d56786935_44448_600x0_resize_q90_h2_box.webp 600w,/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover_hu22b9c7fce07d9deac9cf6b4d56786935_44448_700x0_resize_q90_h2_box.webp 700w"><img src=/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover.jpg srcset="/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover_hu22b9c7fce07d9deac9cf6b4d56786935_44448_300x0_resize_q90_box.jpg 300w,/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover_hu22b9c7fce07d9deac9cf6b4d56786935_44448_400x0_resize_q90_box.jpg 400w,/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover_hu22b9c7fce07d9deac9cf6b4d56786935_44448_500x0_resize_q90_box.jpg 500w,/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover_hu22b9c7fce07d9deac9cf6b4d56786935_44448_600x0_resize_q90_box.jpg 600w,/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform/cover_hu22b9c7fce07d9deac9cf6b4d56786935_44448_700x0_resize_q90_box.jpg 700w" alt width=1001 height=503></picture></div></div><div class=post-content><h2 id=update-2022-02-20>Update 2022-02-20<a href=#update-2022-02-20 class=post-heading__anchor aria-hidden=true>#</a></h2><p>This guide is outdated! <a href=/blog/set-up-azure-active-directory-domain-services-aadds-with-terraform-updated>Please click here to go to the new guide I wrote.</a></p><h2 id=update-2021-08-03>Update 2021-08-03<a href=#update-2021-08-03 class=post-heading__anchor aria-hidden=true>#</a></h2><p>With <a href=https://github.com/terraform-providers/terraform-provider-azurerm/releases/tag/v2.69.0 class=link--external target=_blank rel=noreferrer>v2.69.0 of the official Terraform azurerm provider</a> released two weeks ago, the <a href=https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/active_directory_domain_service class=link--external target=_blank rel=noreferrer><code>active_directory_domain_service</code></a> resource is now available. If you are freshly adding AADDS, there is no point in reading any further — use the official resources.</p><hr><p>Bringing traditional Active Directory Domain Services (AD DS) to the cloud, typically required to set up, secure, and maintain domain controllers (DCs). Azure Active Directory Domain Services (AADDS or Azure AD DS) is a <em>Microsoft-managed</em> solution, providing a subset of <a href=https://docs.microsoft.com/en-us/azure/active-directory-domain-services/compare-identity-solutions class=link--external target=_blank rel=noreferrer>traditional AD DS features</a> without the need to <em>self-manage</em> DCs.</p><p>One such service that requires AD DS features is <a href=https://docs.microsoft.com/en-us/azure/virtual-desktop/overview class=link--external target=_blank rel=noreferrer>Azure Virtual Desktop (WVD)</a>. I have successfully deployed WVD with Terraform, but until recently, I struggled to do the same with AADDS. Today, I show you how to deploy AADDS with Terraform.</p><p>If you are lazy, you can <a href=#wrapping-up>skip to the end</a> and use the custom Terraform module <a href=https://registry.terraform.io/modules/schnerring/aadds/azurerm/latest class=link--external target=_blank rel=noreferrer>I published to the Terraform Registry</a>.</p><h2 id=prerequisites>Prerequisites<a href=#prerequisites class=post-heading__anchor aria-hidden=true>#</a></h2><p>Before getting started, we need the following things:</p><ul><li>Active Azure subscription</li><li><a href=https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-create-new-tenant class=link--external target=_blank rel=noreferrer>Azure Active Directory (Azure AD or AAD) tenant</a></li><li><a href=https://www.terraform.io/downloads.html class=link--external target=_blank rel=noreferrer>Install Terraform</a></li></ul><h2 id=building-blocks>Building Blocks<a href=#building-blocks class=post-heading__anchor aria-hidden=true>#</a></h2><p>So how do we figure out what the required resources are to deploy AADDS? By reverse-engineering the AADDS configuration wizard in the Azure Portal! We launch it by adding a new managed domain after navigating to <strong>Azure AD Domain Services</strong>.</p><p>What we find is that the following resources are required:</p><ul><li>Resource group</li><li>Virtual network and subnet</li><li><code>AAD DC Administrators</code> user group</li></ul><p>Using default values for the remaining configuration options, we can download an <a href=https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview class=link--external target=_blank rel=noreferrer>Azure Resource Manager (ARM) template</a> in the final review step of the wizard.</p><p>Analyzing the ARM template reveals that besides the resource group, virtual network, and subnet, a <a href=https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview class=link--external target=_blank rel=noreferrer>Network Security Group (NSG)</a> with the <a href=https://docs.microsoft.com/en-us/azure/active-directory-domain-services/alert-nsg#inbound-security-rules class=link--external target=_blank rel=noreferrer>security rules required for AADDS</a> is added.</p><p>The ARM template also contains the <code>Microsoft.AAD/domainServices</code> resource, with its parameters set to the configuration options from the wizard. The following is version <code>2021-03-01</code> of the ARM template format <a href="https://docs.microsoft.com/en-us/azure/templates/microsoft.aad/2021-03-01/domainservices?tabs=json" class=link--external target=_blank rel=noreferrer>from the official Azure Template documentation</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;Microsoft.AAD/domainServices&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;apiVersion&#34;</span>: <span style=color:#e6db74>&#34;2021-03-01&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;location&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;tags&#34;</span>: {},
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;domainName&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;replicaSets&#34;</span>: [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;location&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;subnetId&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ldapsSettings&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;ldaps&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;pfxCertificate&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;pfxCertificatePassword&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;externalAccess&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;resourceForestSettings&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;settings&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;trustedDomainFqdn&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;trustDirection&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;friendlyName&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;remoteDnsIps&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;trustPassword&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;resourceForest&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;domainSecuritySettings&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;ntlmV1&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;tlsV1&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;syncNtlmPasswords&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;syncKerberosPasswords&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;syncOnPremPasswords&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;kerberosRc4Encryption&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;kerberosArmoring&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;domainConfigurationType&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sku&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;filteredSync&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;notificationSettings&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;notifyGlobalAdmins&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;notifyDcAdmins&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;additionalRecipients&#34;</span>: [<span style=color:#e6db74>&#34;string&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The docs also reference the <a href=https://github.com/Azure/azure-quickstart-templates/tree/master/101-AAD-DomainServices class=link--external target=_blank rel=noreferrer>Azure Resource Manager QuickStart Template on GitHub</a>. Its README confirms our previous findings but shows that the configuration wizard also must perform the following steps under the hood:</p><ul><li><a href=https://github.com/Azure/azure-quickstart-templates/tree/820b8b7c172d08d0966b0c6f4a80691ca1972410/101-AAD-DomainServices#3-register-the-azure-active-directory-application-service-principal class=link--external target=_blank rel=noreferrer>Register the Azure Active Directory Application Service Principal <code>2565bd9d-da50-47d4-8b85-4c97f669dc36</code></a></li><li><a href=https://github.com/Azure/azure-quickstart-templates/tree/820b8b7c172d08d0966b0c6f4a80691ca1972410/101-AAD-DomainServices#5-register-resource-provider class=link--external target=_blank rel=noreferrer>Register the <code>Microsoft.AAD</code> Resource Provider</a></li></ul><p>With everything figured out, we can continue with the fun part: Terraform!</p><h2 id=putting-everything-together>Putting Everything Together<a href=#putting-everything-together class=post-heading__anchor aria-hidden=true>#</a></h2><p>Let&rsquo;s register the service principal and resource provider first:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azuread_service_principal&#34; &#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  application_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2565bd9d-da50-47d4-8b85-4c97f669dc36&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_resource_provider_registration&#34; &#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Microsoft.AAD&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Next, we add the <code>AAD DC Administrators</code> user group:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azuread_group&#34; &#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  display_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AAD DC Administrators&#34;</span>
</span></span><span style=display:flex><span>  description  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Delegated group to administer Azure AD Domain Services&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Adding the resource group, virtual network, subnet, and NSG is pretty straightforward:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_resource_group&#34; &#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  name     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-rg&#34;</span>
</span></span><span style=display:flex><span>  location <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_virtual_network&#34; &#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  name                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-vnet&#34;</span>
</span></span><span style=display:flex><span>  resource_group_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>  location            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  address_space <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;10.0.0.0/16&#34;</span>]<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # AADDS DCs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  dns_servers <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;10.0.0.4&#34;, &#34;10.0.0.5&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_subnet&#34; &#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  name                 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-snet&#34;</span>
</span></span><span style=display:flex><span>  resource_group_name  <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>  virtual_network_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_virtual_network</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  address_prefixes <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;10.0.0.0/24&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_network_security_group&#34; &#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  name                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-nsg&#34;</span>
</span></span><span style=display:flex><span>  location            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>
</span></span><span style=display:flex><span>  resource_group_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>security_rule</span> {
</span></span><span style=display:flex><span>    name                       <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AllowRD&#34;</span>
</span></span><span style=display:flex><span>    access                     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    priority                   <span style=color:#f92672>=</span> <span style=color:#ae81ff>201</span>
</span></span><span style=display:flex><span>    direction                  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Inbound&#34;</span>
</span></span><span style=display:flex><span>    protocol                   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Tcp&#34;</span>
</span></span><span style=display:flex><span>    source_address_prefix      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;CorpNetSaw&#34;</span>
</span></span><span style=display:flex><span>    source_port_range          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    destination_address_prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    destination_port_range     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;3389&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>security_rule</span> {
</span></span><span style=display:flex><span>    name                       <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AllowPSRemoting&#34;</span>
</span></span><span style=display:flex><span>    access                     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Allow&#34;</span>
</span></span><span style=display:flex><span>    priority                   <span style=color:#f92672>=</span> <span style=color:#ae81ff>301</span>
</span></span><span style=display:flex><span>    direction                  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Inbound&#34;</span>
</span></span><span style=display:flex><span>    protocol                   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Tcp&#34;</span>
</span></span><span style=display:flex><span>    source_address_prefix      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AzureActiveDirectoryDomainServices&#34;</span>
</span></span><span style=display:flex><span>    source_port_range          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    destination_address_prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    destination_port_range     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;5986&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_subnet_network_security_group_association&#34; &#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  subnet_id                 <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_subnet</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>  network_security_group_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_network_security_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Make sure to set <code>dns_servers</code> to the IP addresses of the DCs. You can find them on the <strong>Overview</strong> page of the managed domain after the deployment succeeded.</p><p>The final step is to add the AADDS deployment. Define the ARM template as Terraform <a href=https://www.terraform.io/docs/language/functions/templatefile.html class=link--external target=_blank rel=noreferrer><code>templatefile</code></a> named <code>aadds-arm-template.tpl.json</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;$schema&#34;</span>: <span style=color:#e6db74>&#34;https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;contentVersion&#34;</span>: <span style=color:#e6db74>&#34;1.0.0.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;resources&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;${domainName}&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;Microsoft.AAD/domainServices&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;apiVersion&#34;</span>: <span style=color:#e6db74>&#34;2021-03-01&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;location&#34;</span>: <span style=color:#e6db74>&#34;${location}&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;tags&#34;</span>: <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#960050;background-color:#1e0010>tags</span>},
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;domainName&#34;</span>: <span style=color:#e6db74>&#34;${domainName}&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;replicaSets&#34;</span>: [
</span></span><span style=display:flex><span>          {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;location&#34;</span>: <span style=color:#e6db74>&#34;${location}&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;subnetId&#34;</span>: <span style=color:#e6db74>&#34;${subnetId}&#34;</span>
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        ],
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;domainSecuritySettings&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;ntlmV1&#34;</span>: <span style=color:#e6db74>&#34;${ntlmV1}&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;tlsV1&#34;</span>: <span style=color:#e6db74>&#34;${tlsV1}&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;syncNtlmPasswords&#34;</span>: <span style=color:#e6db74>&#34;${syncNtlmPasswords}&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;syncKerberosPasswords&#34;</span>: <span style=color:#e6db74>&#34;${syncKerberosPasswords}&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;syncOnPremPasswords&#34;</span>: <span style=color:#e6db74>&#34;${syncOnPremPasswords}&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;kerberosRc4Encryption&#34;</span>: <span style=color:#e6db74>&#34;${kerberosRc4Encryption}&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;kerberosArmoring&#34;</span>: <span style=color:#e6db74>&#34;${kerberosArmoring}&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;domainConfigurationType&#34;</span>: <span style=color:#e6db74>&#34;${domainConfigurationType}&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;sku&#34;</span>: <span style=color:#e6db74>&#34;${sku}&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;filteredSync&#34;</span>: <span style=color:#e6db74>&#34;${filteredSync}&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;notificationSettings&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;notifyGlobalAdmins&#34;</span>: <span style=color:#e6db74>&#34;${notifyGlobalAdmins}&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;notifyDcAdmins&#34;</span>: <span style=color:#e6db74>&#34;${notifyDcAdmins}&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;additionalRecipients&#34;</span>: <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#960050;background-color:#1e0010>additionalRecipients</span>}
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We then populate its values dynamically like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_resource_group_template_deployment&#34; &#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  name                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-deploy&#34;</span>
</span></span><span style=display:flex><span>  resource_group_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  deployment_mode <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Incremental&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  template_content <span style=color:#f92672>=</span> <span style=color:#66d9ef>templatefile</span>(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;${path.module}/aadds-arm-template.tpl.json&#34;</span>,
</span></span><span style=display:flex><span>    {<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>      # Basics
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      &#34;domainName&#34;              <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds.schnerring.net&#34;</span>
</span></span><span style=display:flex><span>      &#34;location&#34;                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>
</span></span><span style=display:flex><span>      &#34;sku&#34;                     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Standard&#34;</span>
</span></span><span style=display:flex><span>      &#34;domainConfigurationType&#34; <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;FullySynced&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>      # Networking
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      &#34;subnetId&#34; <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_subnet</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>id</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>      # Administration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      &#34;notifyGlobalAdmins&#34;   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
</span></span><span style=display:flex><span>      &#34;notifyDcAdmins&#34;       <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
</span></span><span style=display:flex><span>      &#34;additionalRecipients&#34; <span style=color:#f92672>=</span> <span style=color:#66d9ef>jsonencode</span>([])<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>      # Synchronization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      &#34;filteredSync&#34; <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>      # Security
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      &#34;tlsV1&#34;                 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
</span></span><span style=display:flex><span>      &#34;ntlmV1&#34;                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
</span></span><span style=display:flex><span>      &#34;syncNtlmPasswords&#34;     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
</span></span><span style=display:flex><span>      &#34;syncOnPremPasswords&#34;   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
</span></span><span style=display:flex><span>      &#34;kerberosRc4Encryption&#34; <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
</span></span><span style=display:flex><span>      &#34;syncKerberosPasswords&#34; <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
</span></span><span style=display:flex><span>      &#34;kerberosArmoring&#34;      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Disabled&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>      # Tags
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      &#34;tags&#34; <span style=color:#f92672>=</span> <span style=color:#66d9ef>jsonencode</span>({})
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  depends_on <span style=color:#f92672>=</span> [<span style=color:#66d9ef>azurerm_resource_provider_registration</span>.<span style=color:#66d9ef>aadds</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Run <code>terraform apply</code> to deploy everything. It takes around 45 minutes to complete.</p><h2 id=wrapping-up>Wrapping Up<a href=#wrapping-up class=post-heading__anchor aria-hidden=true>#</a></h2><p>I created a custom module wrapping the above functionality and <a href=https://registry.terraform.io/modules/schnerring/aadds/azurerm/latest class=link--external target=_blank rel=noreferrer>published it to the Terraform Registry</a>. You can also find <a href=https://github.com/schnerring/terraform-azurerm-aadds class=link--external target=_blank rel=noreferrer>the code on my GitHub</a> along with some examples. I decided that the creation of network resources is out of the module&rsquo;s scope. Depending on what network topology you prefer, pre-provisioning the virtual network and subnet gives you more flexibility.</p><p>The module provides the same options as the Azure Portal configuration wizard. More advanced configuration options like LDAP and forests are not yet supported. Feel free to comment below, or open an issue or pull request on GitHub if you find something to improve.</p><p>A minimal deployment with the custom module looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_resource_group&#34; &#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  name     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-rg&#34;</span>
</span></span><span style=display:flex><span>  location <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_virtual_network&#34; &#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  name                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-vnet&#34;</span>
</span></span><span style=display:flex><span>  resource_group_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>  location            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  address_space <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;10.0.0.0/16&#34;</span>]<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # AADDS DCs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  dns_servers <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;10.0.0.4&#34;, &#34;10.0.0.5&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_subnet&#34; &#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  name                 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-snet&#34;</span>
</span></span><span style=display:flex><span>  resource_group_name  <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>  virtual_network_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_virtual_network</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  address_prefixes <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;10.0.0.0/24&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>module</span> <span style=color:#e6db74>&#34;aadds&#34;</span> {
</span></span><span style=display:flex><span>  source  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;schnerring/aadds/azurerm&#34;</span>
</span></span><span style=display:flex><span>  version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.1.1&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  resource_group_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
</span></span><span style=display:flex><span>  location            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>
</span></span><span style=display:flex><span>  domain_name         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds.schnerring.net&#34;</span>
</span></span><span style=display:flex><span>  subnet_id           <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_subnet</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><div class=social-share><strong class=social-share__heading>Share this post:</strong>
<a class=social-share__item href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fschnerring.net%2Fblog%2Fset-up-azure-active-directory-domain-services-aadds-with-terraform%2F&amp;text=Set+Up+Azure+Active+Directory+Domain+Services+%28AADDS%29+with+Terraform" target=_blank rel=noreferrer><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958.0 002.163-2.723c-.951.555-2.005.959-3.127 1.184A4.92 4.92.0 0011.78 8.288C7.69 8.095 4.067 6.13 1.64 3.162A4.822 4.822.0 00.974 5.637c0 1.71.87 3.213 2.188 4.096A4.904 4.904.0 01.934 9.117v.06a4.923 4.923.0 003.946 4.827 4.996 4.996.0 01-2.212.085 4.936 4.936.0 004.604 3.417A9.867 9.867.0 011.17 19.611c-.39.0-.779-.023-1.17-.067a13.995 13.995.0 007.557 2.209c9.053.0 13.998-7.496 13.998-13.985.0-.21.0-.42-.015-.63A9.935 9.935.0 0024 4.59z"/></svg></a><a class=social-share__item href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fschnerring.net%2Fblog%2Fset-up-azure-active-directory-domain-services-aadds-with-terraform%2F" target=_blank rel=noreferrer><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg></a><a class=social-share__item href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fschnerring.net%2Fblog%2Fset-up-azure-active-directory-domain-services-aadds-with-terraform%2F" target=_blank rel=noreferrer><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Facebook</title><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312.0 2.686.235 2.686.235v2.953H15.83c-1.491.0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg></a><a class=social-share__item href="https://reddit.com/submit?url=https%3A%2F%2Fschnerring.net%2Fblog%2Fset-up-azure-active-directory-domain-services-aadds-with-terraform%2F&amp;title=Set+Up+Azure+Active+Directory+Domain+Services+%28AADDS%29+with+Terraform" target=_blank rel=noreferrer><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Reddit</title><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg></a><a class=social-share__item href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fschnerring.net%2Fblog%2Fset-up-azure-active-directory-domain-services-aadds-with-terraform%2F&amp;t=Set+Up+Azure+Active+Directory+Domain+Services+%28AADDS%29+with+Terraform" target=_blank rel=noreferrer><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Y Combinator</title><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg></a><a class=social-share__item href="mailto:?subject=Set+Up+Azure+Active+Directory+Domain+Services+%28AADDS%29+with+Terraform&amp;body=https%3A%2F%2Fschnerring.net%2Fblog%2Fset-up-azure-active-directory-domain-services-aadds-with-terraform%2F" target=_blank rel=noreferrer><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></div><div id=remark42></div><script>var remark_config={host:"https://remark42.schnerring.net",site_id:"schnerring.net",theme:localStorage.getItem("theme"),show_email_subscription:!1}</script><script>!function(e,t){for(s=0;s<e.length;s++){var s,n=t.createElement("script"),o=".js",i=t.head||t.body;"noModule"in n?(n.type="module",o=".mjs"):n.async=!0,n.defer=!0,n.src=remark_config.host+"/web/"+e[s]+o,i.appendChild(n)}}(remark_config.components||["embed"],document)</script><script>const themeToggleLight=document.getElementsByClassName("theme__toggle light--hidden").item(0);themeToggleLight.addEventListener("click",()=>{setTimeout(()=>window.REMARK42.changeTheme("light"),10)});const themeToggleDark=document.getElementsByClassName("theme__toggle dark--hidden").item(0);themeToggleDark.addEventListener("click",()=>{setTimeout(()=>window.REMARK42.changeTheme("dark"),10)})</script><script>function cookieConsentClick(){localStorage.setItem("cookie-consent",!0);const e=document.getElementById("cookie-consent");e.classList.add("cookie-consent--hidden")}</script><div id=cookie-consent class=cookie-consent--hidden><div class=cli-prompt><div class=cli-prompt__chevron>>&nbsp;</div><div class=cli-prompt__text><span>When you participate in the comments, a cookie is used to keep you logged in.</span>
<span class=cli-prompt__cursor>█</span></div><button onclick=cookieConsentClick()>Got it!</button></div></div><script>const cookieConsentAccepted=localStorage&&localStorage.getItem("cookie-consent");if(!cookieConsentAccepted){const e=document.getElementById("cookie-consent");e.classList.remove("cookie-consent--hidden")}</script></article></div><div class=sidebar><aside class=bio><div class="jr__item jr-basics__item"><div class=jr-basics__image><img src=https://schnerring.net/michael-schnerring.jpg alt="Picture of Michael Schnerring" width=250 height=250></div><div class=jr-basics__name>Michael Schnerring</div><div class=jr-basics__label>Software Engineer</div><div class=jr-basics__summary>I've been a computer geek all my life. I'm passionate about open-source and digital privacy. I like video games and CrossFit. I'm also terrible at blogging.</div><div class=jr-basics__location-city>Basel</div><div class=jr-basics__location-region>Switzerland</div><hr><div class="jr-basics__profile jr-basics__profile--row"><a href=https://github.com/schnerring><div class=jr-basics__profile-item><div class=jr-basics__profile-icon><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a><a href=https://twitter.com/schnerringo><div class=jr-basics__profile-item><div class=jr-basics__profile-icon><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958.0 002.163-2.723c-.951.555-2.005.959-3.127 1.184A4.92 4.92.0 0011.78 8.288C7.69 8.095 4.067 6.13 1.64 3.162A4.822 4.822.0 00.974 5.637c0 1.71.87 3.213 2.188 4.096A4.904 4.904.0 01.934 9.117v.06a4.923 4.923.0 003.946 4.827 4.996 4.996.0 01-2.212.085 4.936 4.936.0 004.604 3.417A9.867 9.867.0 011.17 19.611c-.39.0-.779-.023-1.17-.067a13.995 13.995.0 007.557 2.209c9.053.0 13.998-7.496 13.998-13.985.0-.21.0-.42-.015-.63A9.935 9.935.0 0024 4.59z"/></svg></div></div></a><a href=https://hachyderm.io/@schnerring><div class=jr-basics__profile-item><div class=jr-basics__profile-icon><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792.0 11.813.0h-.03c-3.98.0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057.0 00.023-.043v-1.809a.052.052.0 00-.02-.041.053.053.0 00-.046-.01 20.282 20.282.0 01-4.709.545c-2.73.0-3.463-1.284-3.674-1.818a5.593 5.593.0 01-.319-1.433.053.053.0 01.066-.054c1.517.363 3.072.546 4.632.546.376.0.75.0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23.0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112.0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311.0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13.0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg></div></div></a><a href=https://www.linkedin.com/in/schnerring><div class=jr-basics__profile-item><div class=jr-basics__profile-icon><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg></div></div></a><a href=https://schnerring.net/index.xml><div class=jr-basics__profile-item><div class=jr-basics__profile-icon><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>RSS</title><path d="M19.199 24C19.199 13.467 10.533 4.8.0 4.8V0c13.165.0 24 10.835 24 24h-4.801zM3.291 17.415c1.814.0 3.293 1.479 3.293 3.295.0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526.0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727.0 15.909 7.184 15.909 15.91z"/></svg></div></div></a></div></div></aside></div></main><footer><div class=copyright>© 2020 - 2023 Michael Schnerring</div></footer><script src=/js/main.c26c1b7b76f4923d8125720886ede9ca08bfe20b924683914ba4c1c35d53667c6c2d764f5482d3860d36b9e58a50255bc22a03ff145555979852c5ec74f15e51.js integrity="sha512-wmwbe3b0kj2BJXIIhu3pygi/4guSRoORS6TBw11TZnxsLXZPVILThg02ueWKUCVbwioD/xRVVZeYUsXsdPFeUQ=="></script>
<script src=/js/flexsearch.ac29336bed102bfef72157a30dac525e0e5c87e6824171a6e8db22f24609703035405c6c89789ad71bd5a39fcd8fd7ad84bc20ce50d128d67d939c9dea0f0406.js integrity="sha512-rCkza+0QK/73IVejDaxSXg5ch+aCQXGm6Nsi8kYJcDA1QFxsiXia1xvVo5/Nj9ethLwgzlDRKNZ9k5yd6g8EBg=="></script></div></body></html>