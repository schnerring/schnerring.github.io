<!doctype html><html lang=en><head><title>Use the Trezor Hardware Wallet Anonymously Inside a VirtualBox Whonix VM With External Wallets Like Adalite and Monero GUI ::
Michael Schnerring — Coder and Computer Enthusiast</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In the past, I used an old laptop running Qubes OS for any cryptocurrency-related stuff, and it worked great. It&amp;rsquo;s where I first learned about Whonix, a desktop operating system designed to protect your privacy online. Unfortunately, Qubes OS is a bit picky about the hardware it runs on. My old laptop only has four gigs of RAM, and I could barely run two instances of MyEtherWallet in two separate qubes without the system running out of memory."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://schnerring.net/posts/use-the-trezor-hardware-wallet-anonymously-inside-a-virtualbox-whonix-vm-with-external-wallets-like-adalite-and-monero-gui/><link rel=stylesheet href=https://schnerring.net/assets/style.css><link rel=stylesheet href=https://schnerring.net/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://schnerring.net/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://schnerring.net/img/favicon.png><link href=https://schnerring.net/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://schnerring.net/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://schnerring.net/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://schnerring.net/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://schnerring.net/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://schnerring.net/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="Use the Trezor Hardware Wallet Anonymously Inside a VirtualBox Whonix VM With External Wallets Like Adalite and Monero GUI"><meta name=twitter:description content="In the past, I used an old laptop running Qubes OS for any cryptocurrency-related stuff, and it worked great. It&rsquo;s where I first learned about Whonix, a desktop operating system designed to protect your privacy online. Unfortunately, Qubes OS is a bit picky about the hardware it runs on. My old laptop only has four gigs of RAM, and I could barely run two instances of MyEtherWallet in two separate qubes without the system running out of memory."><meta property="og:title" content="Use the Trezor Hardware Wallet Anonymously Inside a VirtualBox Whonix VM With External Wallets Like Adalite and Monero GUI"><meta property="og:description" content="In the past, I used an old laptop running Qubes OS for any cryptocurrency-related stuff, and it worked great. It&rsquo;s where I first learned about Whonix, a desktop operating system designed to protect your privacy online. Unfortunately, Qubes OS is a bit picky about the hardware it runs on. My old laptop only has four gigs of RAM, and I could barely run two instances of MyEtherWallet in two separate qubes without the system running out of memory."><meta property="og:type" content="article"><meta property="og:url" content="https://schnerring.net/posts/use-the-trezor-hardware-wallet-anonymously-inside-a-virtualbox-whonix-vm-with-external-wallets-like-adalite-and-monero-gui/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-22T20:15:36+02:00"><meta property="article:modified_time" content="2021-10-22T20:15:36+02:00"><meta property="og:site_name" content="Michael Schnerring"><script async defer data-domain=schnerring.net src=https://plausible.schnerring.net/js/plausible.js></script></head><body><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>schnerring.net</span>
<span class=logo__cursor></span></a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>Use the Trezor Hardware Wallet Anonymously Inside a VirtualBox Whonix VM With External Wallets Like Adalite and Monero GUI</h1><div class=post-meta><span class=post-date>2021-10-22</span></div><span class=post-tags><a href=https://schnerring.net/tags/adalite/>#adalite</a>&nbsp;
<a href=https://schnerring.net/tags/anonymity/>#anonymity</a>&nbsp;
<a href=https://schnerring.net/tags/cardano/>#cardano</a>&nbsp;
<a href=https://schnerring.net/tags/cryptocurrency/>#cryptocurrency</a>&nbsp;
<a href=https://schnerring.net/tags/monero/>#monero</a>&nbsp;
<a href=https://schnerring.net/tags/privacy/>#privacy</a>&nbsp;
<a href=https://schnerring.net/tags/qubes-os/>#qubes os</a>&nbsp;
<a href=https://schnerring.net/tags/trezor/>#trezor</a>&nbsp;
<a href=https://schnerring.net/tags/virtualbox/>#virtualbox</a>&nbsp;
<a href=https://schnerring.net/tags/whonix/>#whonix</a>&nbsp;</span><figure class=post-cover><img src=https://schnerring.net/posts/use-the-trezor-hardware-wallet-anonymously-inside-a-virtualbox-whonix-vm-with-external-wallets-like-adalite-and-monero-gui/img/cover.png alt="Use the Trezor Hardware Wallet Anonymously Inside a VirtualBox Whonix VM With External Wallets Like Adalite and Monero GUI"></figure><div class=post-content><p>In the past, I used an old laptop running <a href=https://www.qubes-os.org/>Qubes OS</a> for any cryptocurrency-related stuff, and it worked great. It&rsquo;s where I first learned about <a href=https://www.whonix.org>Whonix</a>, a desktop operating system designed to protect your privacy online. Unfortunately, Qubes OS is a bit picky about the hardware it runs on. My old laptop only has four gigs of RAM, and I could barely run two instances of <a href=https://www.myetherwallet.com>MyEtherWallet</a> in two separate <a href=https://www.qubes-os.org/doc/glossary/#qube>qubes</a> without the system running out of memory.</p><h2 id=the-final-straw>The Final Straw</h2><p>When initially configuring my Qubes OS environment for Monero, I decided to go with <a href=https://www.getmonero.org/resources/user-guides/cli_wallet_daemon_isolation_qubes_whonix.html>the setup described in a user guide from the official Monero website</a>:</p><blockquote><p>With Qubes + Whonix you can have a Monero wallet that is without networking and running on a virtually isolated system from the Monero daemon which has all of its traffic forced over Tor.</p></blockquote><p>Out of the blue, after more than a year of using this setup, I couldn&rsquo;t start the daemon and the wallet GUI simultaneously anymore. I only had enough RAM to launch one, but not both, which made the setup unusable. So I had to buy new hardware.</p><h2 id=reducing-the-complexity>Reducing The Complexity</h2><p>I would have loved to get a <a href=https://shop.nitrokey.com/shop/product/nitropad-x230-67>NitroPad X230</a>, a <a href=https://www.qubes-os.org/doc/certified-hardware/>Qubes OS-certified</a> laptop tinker around with Qubes OS some more. Also, the guys at <a href=https://www.nitrokey.com/>Nitrokey</a> are doing a great job in the open-source space and deserve any support they get. But I ultimately decided to reduce the complexity of my crypto setup and went with a hardware wallet instead — the <a href=https://shop.trezor.io/product/trezor-model-t>Trezor Model T</a>.</p><p>I&rsquo;ll guide you through my new &ldquo;Whonix on VirtualBox&rdquo; setup and the steps required to configure it.</p><h2 id=import-the-virtualbox-whonix-appliance>Import the VirtualBox Whonix Appliance</h2><p>First, <a href=https://www.whonix.org/wiki/VirtualBox/XFCE>we download the VirtualBox appliance provided by Whonix</a> and <a href=https://www.whonix.org/wiki/VirtualBox/Verify_the_virtual_machine_images_using_the_command_line>make sure to verify the binary</a>. This requires different steps depending on the OS you are using.</p><p>Next, we import the appliance into VirtualBox by clicking <strong>File</strong> → <strong>Import Appliance&mldr;</strong>, creating two VMs — the gateway and the workstation. The gateway connects us to the Tor network. The workstation will only connect through that gateway, so both VMs must run if we want to connect to the outside world from within the workstation VM.</p><p>Make sure to read the <a href=https://www.whonix.org/wiki/Post_Install_Advice#Security_Updates>Post-installation Security Advice from the official Whonix docs</a>. We <a href=https://www.whonix.org/wiki/Post_Install_Advice#Change_Password>change the default user password</a> and <a href=https://www.whonix.org/wiki/Operating_System_Software_and_Updates>install the latest updates</a> for the gateway at the very least. After, we repeat the same for the workstation VM.</p><p>At this point, we can optionally clone the workstation VM to have a clean Whonix image if we ever want to start over from scratch.</p><h2 id=install-the-trezor-dependencies>Install the Trezor Dependencies</h2><p>We can now connect the Trezor device to our computer. We then right-click on the workstation VM and select <strong>Settings&mldr;</strong>. Under <strong>USB</strong>, we check the <strong>Enable USB Controller</strong> and add the <strong>Trezor</strong> device. This way, it will be automatically attached to the workstation VM.</p><p><img src=img/enable-usb-controller.png alt="Enable USB Controller"></p><p>Let&rsquo;s start the VM, open a terminal, and <a href=https://wiki.trezor.io/Udev_rules>import the udev rule for Trezor</a> to enable communication with the Trezor device via Linux kernel:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>sudo curl https://data.trezor.io/udev/51-trezor.rules -o /etc/udev/rules.d/51-trezor.rules
</code></pre></div><p>Next, we <a href=https://trezor.io/security/satoshilabs-2021-signing-key.asc>download the SatoshiLabs 2021 Signing Key</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>wget https://trezor.io/security/satoshilabs-2021-signing-key.asc
</code></pre></div><p>We verify the authenticity of the key by running:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>gpg --with-fingerprint ./satoshilabs-2021-signing-key.asc
</code></pre></div><p>The value of the fingerprint is <code>EB48 3B26 B078 A4AA 1B6F 425E E21B 6950 A2EC B65C</code>. If it&rsquo;s not, something is very wrong — do <strong>NOT</strong> continue! If everything looks good, we import the key:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>gpg --import ./satoshilabs-2021-signing-key.asc
</code></pre></div><p>Then we download the <a href=https://suite.trezor.io/>Trezor Suite</a> and corresponding signature by running the following in the terminal (replace <code>XX.XX.X</code> with the latest version):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>wget https://suite.trezor.io/web/static/desktop/Trezor-Suite-XX.XX.X-linux-x86_64.AppImage
wget https://suite.trezor.io/web/static/desktop/Trezor-Suite-XX.XX.X-linux-x86_64.AppImage.asc
</code></pre></div><p>We verify the binaries by running:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>gpg --verify ./Trezor-Suite-XX.XX.X-linux-x86_64.AppImage.asc
</code></pre></div><p>The output should contain:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>Good signature from &#34;SatoshiLabs 2021 Signing Key&#34;
</code></pre></div><p>Next, we make the binary executable:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell> chmod +x ./Trezor-Suite-XX.XX.X-linux-x86_64.AppImage
</code></pre></div><p>To launch the Trezor suite and connect to our hardware wallet, we run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./Trezor-Suite-XX.XX.X-linux-x86_64.AppImage
</code></pre></div><p>At this point, we can shut down the VM and take a snapshot so we can roll back later if we need to. I like to clone this VM again for each cryptocurrency requiring an external wallet. It increases the security and maintainability of the setup.</p><h2 id=using-the-monero-gui>Using the Monero GUI</h2><p>Besides giving the workstation VM a little more RAM, Monero doesn&rsquo;t require additional setup since Whonix includes the Monero GUI. We launch the app and wait for the Monero daemon to sync, which might take a long time using Tor. After that, we&rsquo;re ready to go!</p><h2 id=setting-up-adalite>Setting Up Adalite</h2><p><a href=https://adalite.io/>Adalite</a> is an open-source, in-browser wallet, and only a few steps are required to get it working.</p><p>First, we open the Tor browser and allow pop-up windows from <a href=https://adalite.io>https://adalite.io</a> by adding an exception for it under <strong>Settings</strong> → <strong>Preferences</strong> → <strong>Privacy & Security</strong>.</p><p>Next, we launch the Trezor Suite by running <code>./Trezor-Suite-XX.XX.X-linux-x86_64.AppImage</code>. It starts the included Trezor Bridge, which Adalite requires to communicate with the Trezor device. We can verify the Trezor Bridge is running by navigating to <a href=http://127.0.0.1:21325/status/>http://127.0.0.1:21325/status/</a> in the browser.</p><p>The final step is to change two advanced settings of the Tor browser by navigating to <code>about:config</code> and clicking <strong>Accept the Risk and Continue</strong>. We set the <code>network.proxy.no_proxies_on</code> to <code>127.0.0.1:21325</code>, so traffic to the Trezor Bridge is not proxied through the Tor network. We also need to disable First-Party Isolation by setting <code>privacy.firstparty.isolate</code> to <code>false</code>.</p><p>We can now use Adalite by navigating to <a href=https://adalite.io>https://adalite.io</a>. It might be a good idea to bookmark that address, so you don&rsquo;t fall victim to a phishing attack in case of a typ-o.</p><h2 id=closing-thoughts>Closing Thoughts</h2><p>For my purposes, this setup provides more than enough anonymity. Depending on your needs, it might be overkill or might not be anonymous or secure enough. It always depends on your threat model.</p><p>What I don&rsquo;t understand is why SatoshLabs publishes a new signing key every year. Just one more thing to keep in mind come next year.</p></div><div id=remark42></div><script>const defaultTheme="light";function getHelloFriendTheme(){const a=localStorage&&localStorage.getItem("theme");return a||defaultTheme}</script><script>var remark_config={host:"https://remark42.schnerring.net",site_id:"schnerring.net",theme:getHelloFriendTheme(),show_email_subscription:!1}</script><script>!function(d,b){for(var c=0,a,e,f;c<d.length;c++)a=b.createElement("script"),e=".js",f=b.head||b.body,"noModule"in a?(a.type="module",e=".mjs"):a.async=!0,a.defer=!0,a.src=remark_config.host+"/web/"+d[c]+e,f.appendChild(a)}(remark_config.components||["embed"],document)</script><script>const themeToggle=document.querySelector(".theme-toggle");themeToggle.addEventListener("click",()=>{setTimeout(()=>window.REMARK42.changeTheme(getHelloFriendTheme()),10)})</script></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><p>Copyright © 2020 Michael Schnerring</p><p xmlns:dct=http://purl.org/dc/terms/ xmlns:cc=http://creativecommons.org/ns# class=license-text><a rel=cc:attributionurl property="dct:title" href=https://github.com/schnerring/schnerring.github.io/tree/main/content>Content</a> licensed under <a rel=license href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a></p></div></div></footer><script src=https://schnerring.net/assets/main.js></script><script src=https://schnerring.net/assets/prism.js></script></div></body></html>