<!doctype html><html lang=en theme=dark>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=preload as=font type=font/woff2 href=/fonts/roboto-slab-latin-400.woff2 crossorigin=anonymous>
<link rel=prefetch as=font type=font/woff2 href=/fonts/roboto-slab-latin-700.woff2 crossorigin=anonymous>
<link rel=preload as=font type=font/woff2 href=/fonts/fira-code-latin-300.woff2 crossorigin=anonymous>
<link rel=preload as=font type=font/woff2 href=/fonts/fira-code-latin-400.woff2 crossorigin=anonymous>
<link rel=prefetch as=font type=font/woff2 href=/fonts/fira-code-latin-700.woff2 crossorigin=anonymous>
<meta name=robots content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
<title>Set Up Azure Active Directory Domain Services (AADDS) with Terraform&nbsp;::&nbsp;Michael Schnerring&nbsp;—&nbsp;Software Engineer</title>
<meta name=description content="Update 2021-08-03 #  With v2.69.0 of the official Terraform azurerm provider released two weeks ago, the active_directory_domain_service and active_directory_domain_service_replica_set resources are now available. If you are newly adding AADDS, there is no point in reading any further — use the official resources.
I will switch in the coming weeks and write a short migration guide for the people using my AADDS Terraform module.
 Bringing traditional Active Directory Domain Services (AD DS) to the cloud, typically required to set up, secure, and maintain domain controllers (DCs). Azure Active Directory Domain Services (AADDS or Azure AD DS) is a Microsoft-managed solution, providing a subset of traditional AD DS features without the need to self-manage DCs.
One such service that requires AD DS features is Windows Virtual Desktop (WVD). I have successfully deployed WVD with Terraform, but until recently, I struggled to do the same with AADDS. Today, I show you how to deploy AADDS with Terraform.
">
<link rel=canonical href=https://schnerring.net/posts/set-up-azure-active-directory-domain-services-aadds-with-terraform/>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Set Up Azure Active Directory Domain Services (AADDS) with Terraform">
<meta name=twitter:description content="
  Update 2021-08-03
  #

With v2.69.0 of the official Terraform azurerm provider released two weeks ago, the active_directory_domain_service and active_directory_domain_service_replica_set resources are now available. If you are newly adding AADDS, there is no point in reading any further — use the official resources.
I will switch in the coming weeks and write a short migration guide for the people using my AADDS Terraform module.

Bringing traditional Active Directory Domain Services (AD DS) to the cloud, typically required to set up, secure, and maintain domain controllers (DCs). Azure Active Directory Domain Services (AADDS or Azure AD DS) is a Microsoft-managed solution, providing a subset of traditional AD DS features without the need to self-manage DCs.
One such service that requires AD DS features is Windows Virtual Desktop (WVD). I have successfully deployed WVD with Terraform, but until recently, I struggled to do the same with AADDS. Today, I show you how to deploy AADDS with Terraform.">
<meta property="og:title" content="Set Up Azure Active Directory Domain Services (AADDS) with Terraform">
<meta property="og:description" content="
  Update 2021-08-03
  #

With v2.69.0 of the official Terraform azurerm provider released two weeks ago, the active_directory_domain_service and active_directory_domain_service_replica_set resources are now available. If you are newly adding AADDS, there is no point in reading any further — use the official resources.
I will switch in the coming weeks and write a short migration guide for the people using my AADDS Terraform module.

Bringing traditional Active Directory Domain Services (AD DS) to the cloud, typically required to set up, secure, and maintain domain controllers (DCs). Azure Active Directory Domain Services (AADDS or Azure AD DS) is a Microsoft-managed solution, providing a subset of traditional AD DS features without the need to self-manage DCs.
One such service that requires AD DS features is Windows Virtual Desktop (WVD). I have successfully deployed WVD with Terraform, but until recently, I struggled to do the same with AADDS. Today, I show you how to deploy AADDS with Terraform.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://schnerring.net/posts/set-up-azure-active-directory-domain-services-aadds-with-terraform/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-05-22T16:23:36+02:00">
<meta property="article:modified_time" content="2021-05-22T16:23:36+02:00">
<meta itemprop=name content="Set Up Azure Active Directory Domain Services (AADDS) with Terraform">
<meta itemprop=description content="
  Update 2021-08-03
  #

With v2.69.0 of the official Terraform azurerm provider released two weeks ago, the active_directory_domain_service and active_directory_domain_service_replica_set resources are now available. If you are newly adding AADDS, there is no point in reading any further — use the official resources.
I will switch in the coming weeks and write a short migration guide for the people using my AADDS Terraform module.

Bringing traditional Active Directory Domain Services (AD DS) to the cloud, typically required to set up, secure, and maintain domain controllers (DCs). Azure Active Directory Domain Services (AADDS or Azure AD DS) is a Microsoft-managed solution, providing a subset of traditional AD DS features without the need to self-manage DCs.
One such service that requires AD DS features is Windows Virtual Desktop (WVD). I have successfully deployed WVD with Terraform, but until recently, I struggled to do the same with AADDS. Today, I show you how to deploy AADDS with Terraform."><meta itemprop=datePublished content="2021-05-22T16:23:36+02:00">
<meta itemprop=dateModified content="2021-05-22T16:23:36+02:00">
<meta itemprop=wordCount content="1117">
<meta itemprop=keywords content="aadds,arm,azure active directory domain services,azure resource manager template,terraform,">
<script async defer data-domain=schnerring.net src=https://plausible.schnerring.net/js/plausible.js></script>
<style>@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:100;src:local("Roboto Slab Thin "),local("Roboto Slab-Thin"),url(/fonts/roboto-slab-latin-100.woff2) format("woff2"),url(/fonts/roboto-slab-latin-100.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:200;src:local("Roboto Slab Extra Light "),local("Roboto Slab-Extra Light"),url(/fonts/roboto-slab-latin-200.woff2) format("woff2"),url(/fonts/roboto-slab-latin-200.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:300;src:local("Roboto Slab Light "),local("Roboto Slab-Light"),url(/fonts/roboto-slab-latin-300.woff2) format("woff2"),url(/fonts/roboto-slab-latin-300.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:400;src:local("Roboto Slab Regular "),local("Roboto Slab-Regular"),url(/fonts/roboto-slab-latin-400.woff2) format("woff2"),url(/fonts/roboto-slab-latin-400.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:500;src:local("Roboto Slab Medium "),local("Roboto Slab-Medium"),url(/fonts/roboto-slab-latin-500.woff2) format("woff2"),url(/fonts/roboto-slab-latin-500.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:600;src:local("Roboto Slab SemiBold "),local("Roboto Slab-SemiBold"),url(/fonts/roboto-slab-latin-600.woff2) format("woff2"),url(/fonts/roboto-slab-latin-600.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:700;src:local("Roboto Slab Bold "),local("Roboto Slab-Bold"),url(/fonts/roboto-slab-latin-700.woff2) format("woff2"),url(/fonts/roboto-slab-latin-700.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:800;src:local("Roboto Slab ExtraBold "),local("Roboto Slab-ExtraBold"),url(/fonts/roboto-slab-latin-800.woff2) format("woff2"),url(/fonts/roboto-slab-latin-800.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto Slab;font-style:normal;font-weight:900;src:local("Roboto Slab Black "),local("Roboto Slab-Black"),url(/fonts/roboto-slab-latin-900.woff2) format("woff2"),url(/fonts/roboto-slab-latin-900.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:300;src:local("Fira Code Light "),local("Fira Code-Light"),url(/fonts/fira-code-latin-300.woff2) format("woff2"),url(/fonts/fira-code-latin-300.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:400;src:local("Fira Code Regular "),local("Fira Code-Regular"),url(/fonts/fira-code-latin-400.woff2) format("woff2"),url(/fonts/fira-code-latin-400.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:500;src:local("Fira Code Medium "),local("Fira Code-Medium"),url(/fonts/fira-code-latin-500.woff2) format("woff2"),url(/fonts/fira-code-latin-500.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:600;src:local("Fira Code SemiBold "),local("Fira Code-SemiBold"),url(/fonts/fira-code-latin-600.woff2) format("woff2"),url(/fonts/fira-code-latin-600.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Code;font-style:normal;font-weight:700;src:local("Fira Code Bold "),local("Fira Code-Bold"),url(/fonts/fira-code-latin-700.woff2) format("woff2"),url(/fonts/fira-code-latin-700.woff) format("woff")}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}:root[theme=light]{--bg:var(--bg0_h);--bg0:#fbf1c7;--bg0_h:#f9f5d7;--bg0_s:#f2e5bc;--bg1:#ebdbb2;--bg2:#d5c4a1;--bg3:#bdae93;--bg4:#a89984;--fg:var(--fg1);--fg0:#282828;--fg1:#3c3836;--fg2:#504945;--fg3:#665c54;--fg4:#7c6f64;--gray1:var(--fg4);--gray2:#928374;--red1:#cc241d;--red2:#9d0006;--green1:#98971a;--green2:#797403;--yellow1:#d79921;--yellow2:#b57614;--blue1:#458588;--blue2:#076678;--purple1:#b16286;--purple2:#8f3f71;--aqua1:#689d6a;--aqua2:#427b58;--orange1:#d65d0e;--orange2:#af3a03}:root[theme=light] .light--hidden{display:none}:root[theme=dark]{--bg:var(--bg0_h);--bg0:#282828;--bg0_h:#1d2021;--bg0_s:#32302f;--bg1:#3c3836;--bg2:#504945;--bg3:#665c54;--bg4:#7c6f64;--fg:var(--fg1);--fg0:#fbf1c7;--fg1:#ebdbb2;--fg2:#d5c4a1;--fg3:#bdae93;--fg4:#a89984;--gray1:var(--fg4);--gray2:#928374;--red1:#cc241d;--red2:#fb4934;--green1:#98971a;--green2:#b8bb26;--yellow1:#d79921;--yellow2:#fabd2f;--blue1:#458588;--blue2:#83a598;--purple1:#b16286;--purple2:#d3869b;--aqua1:#689d6a;--aqua2:#8ec07c;--orange1:#d65d0e;--orange2:#fe8019}:root[theme=dark] .dark--hidden{display:none}:root{--primary:var(--aqua1);--primary-alt:var(--aqua2);--font-monospace:"Fira Code","Lucida Console",Monaco,monospace;--font-sans-serif:Verdana,Helvetica,sans-serif;--font-serif:"Roboto Slab",Georgia,serif}html{font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);font-size:1rem}body{background:var(--bg);color:var(--fg);line-height:1.6}a{color:inherit;text-decoration:none}a.link--external :not(img){white-space:nowrap}a.link--external :not(img):after{content:"\2009↗"}img{border:2px solid var(--bg1);height:auto;max-width:100%}::-moz-selection{background:var(--bg4);color:var(--fg0)}::selection{background:var(--bg4);color:var(--fg0)}h1,h2,h3,h4{color:var(--fg0);font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);font-weight:300;line-height:1.4}h1 code,h2 code,h3 code,h4 code{font-size:1em}h2,h3,h4{border-bottom:1px solid var(--bg1)}h1{font-size:1.875rem}h2{font-size:1.75rem}h3{font-size:1.625rem}@media (min-width:768px){h1{font-size:2.375rem}h2{font-size:2rem}h3{font-size:1.75rem}}h4{font-size:1.5rem}table{border-collapse:collapse;margin:2rem 0;table-layout:fixed;width:100%}table,td,th{border:1px solid var(--bg1);padding:.5rem}hr{background:var(--bg1);border:none;height:1px;margin:3rem auto;width:80%}blockquote,code,pre{border-radius:.2rem;padding:0 .2em}pre code{padding:0}blockquote,code,pre,th{background:var(--bg1)}code,pre,th{font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace)}code code{background:var(--bg2)}blockquote,pre{padding:1rem}pre{background:var(--bg1)!important;overflow:auto}pre code{background:none}blockquote{border-left:5px solid var(--primary-alt);margin:.5rem 0}blockquote code{background:var(--bg2)}blockquote p:first-of-type{margin-top:0}blockquote p:last-of-type{margin-bottom:0}pre::-webkit-scrollbar{height:.5rem;scrollbar-width:auto}pre::-webkit-scrollbar-track{background:var(--bg2);border-radius:.2rem}pre::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:.2rem}.layout{display:grid;grid-template-areas:"header" "main" "footer";grid-template-rows:auto 1fr auto;height:100vh}main{align-items:start;display:grid;grid-area:main;grid-template-areas:"empty content sidebar";grid-template-columns:1fr minmax(0,650px) 4fr}header{background:var(--bg1);grid-area:header}footer{grid-area:footer}footer,main{margin:.5em 1em}.content{grid-area:content}.sidebar{display:none;flex-direction:column;grid-area:sidebar;margin-top:3rem;position:-webkit-sticky;position:sticky;top:2rem}@media (min-width:992px){.sidebar{display:flex}}header{display:grid;font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);font-size:1.125rem;grid-template-areas:"heading search nav theme-toggle";grid-template-columns:auto auto 1fr auto;padding:.75rem}.logo{color:var(--fg0);display:flex;font-weight:700;grid-area:heading}.logo:hover .logo__cursor{-webkit-animation:blink 1s infinite;animation:blink 1s infinite;opacity:1}.logo__chevron,.logo__cursor{margin-left:.5rem}.logo__cursor{opacity:0}.logo__text{display:none}@media (min-width:768px){.logo__text{display:block}}.search{display:flex;grid-area:search;margin:0 1rem}#search__text{background:var(--bg2);border:1px solid var(--bg2);border-radius:.2rem;caret-color:var(--fg);color:var(--fg);outline:none;padding:0 .5rem;width:100%}#search__text:hover{border-color:var(--bg3)}#search__text:focus{border-color:var(--bg4)}#search__text::-moz-placeholder{color:var(--fg3)}#search__text:-ms-input-placeholder{color:var(--fg3)}#search__text::placeholder{color:var(--fg3)}#search__text[type=search]::-webkit-search-cancel-button{-webkit-appearance:none;appearance:none}#search__suggestions{background:var(--bg);border-radius:.2rem;box-shadow:0 .5rem 1rem var(--bg1);font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);left:0;margin-top:2rem;position:absolute;width:95vw;z-index:1000}@media (min-width:768px){.search{position:relative}#search__suggestions{width:60vw}}.search__suggestions--hidden{display:none}.search__suggestion-item{border-bottom:1px dashed var(--bg2);display:grid;grid-template-columns:1fr 2fr}.search__suggestion-item.focus-visible,.search__suggestion-item:focus,.search__suggestion-item:hover{background:var(--bg1);cursor:pointer;outline:none}.search__suggestion-item:focus,.search__suggestion-item:focus-visible,.search__suggestion-item:hover{background:var(--bg1);cursor:pointer;outline:none}.search__suggestion-item:last-child{border:none}.search__suggestion-description,.search__suggestion-title{margin:1rem 0;padding:0 1rem}.search__suggestion-title{font-weight:700}.search__suggestion-description{border-left:1px solid var(--bg2)}.theme__toggle{align-items:center;background:none;border:none;color:var(--yellow1);cursor:pointer;display:flex;grid-area:theme-toggle;margin:0 1rem}.theme__toggle:hover{color:var(--yellow2)}.theme__toggle svg{height:28px;width:28px}nav#menu{align-items:center;display:flex;grid-area:nav;justify-content:flex-end}nav#menu .menu__item{color:var(--fg)}nav#menu .menu__item:hover{color:var(--fg3);cursor:pointer}nav#menu ul{list-style:none;margin:0;padding:0}nav#menu ul.menu--horizontal{align-items:center;display:none}nav#menu ul.menu--horizontal li{display:inline-block;margin:0 .75rem}@media (min-width:768px){nav#menu ul.menu--horizontal{display:flex}}nav#menu ul.menu--vertical{background:var(--fg0);bottom:0;margin:0;padding:3rem;position:fixed;right:0;top:0;transform:translate(100%);transition:transform .5s cubic-bezier(.9,0,.1,1);width:50%;z-index:10}nav#menu ul.menu--vertical .menu__item{color:var(--bg1)}nav#menu ul.menu--vertical .menu__item:hover{color:var(--bg4)}nav#menu .menu__burger{display:flex;height:24px;width:24px}nav#menu .menu__burger>*{position:absolute}nav#menu .menu__burger svg{height:inherit;width:inherit;z-index:20}nav#menu .menu__burger svg line{transition-duration:.5s;transition-property:stroke,opacity,transform;transition-timing-function:cubic-bezier(.9,0,.1,1)}nav#menu .menu__burger svg line:first-of-type{transform-origin:center 6px}nav#menu .menu__burger svg line:nth-of-type(2){transform-origin:center 12px}nav#menu .menu__burger svg line:nth-of-type(3){transform-origin:center 18px}nav#menu .menu__burger input{height:inherit;opacity:0;width:inherit;z-index:30}nav#menu .menu__burger input:checked~ul.menu--vertical{transform:none}nav#menu .menu__burger input:checked~svg{stroke:var(--bg1)}nav#menu .menu__burger input:checked~svg line:first-of-type{transform:translateY(6px) rotate(45deg)}nav#menu .menu__burger input:checked~svg line:nth-of-type(2){opacity:0;transform:scale(.2)}nav#menu .menu__burger input:checked~svg line:nth-of-type(3){transform:translateY(-6px) rotate(-45deg)}@media (min-width:768px){nav#menu .menu__burger{display:none}}

/*! Source: https://stackoverflow.com/a/36118384/1154965 */@keyframes blink{50%{opacity:0}to{opacity:1}}.sidebar{font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);margin-left:auto;margin-right:auto;max-width:350px;padding-left:2.5rem}.sidebar svg{fill:var(--fg)}.jr-basics__image{background:var(--bg1);border:2px solid var(--bg2)}.jr-basics__description{color:var(--fg3);font-family:Roboto Slab,Georgia,serif;font-family:var(--font-serif);font-style:italic}.jr-basics__profile a:hover{color:var(--fg3)}.jr-basics__profile a:hover svg{fill:var(--fg3)}.post{border-bottom:2px dotted var(--bg1);padding:2rem 0}.post-content__read-more,.post-header{font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace)}.post-meta{color:var(--fg3)}.post-meta img:not(figure img){margin:.5rem 0}.post-content{margin:1.3rem 0}.post-content img:not(figure img){margin:.5rem 1rem;max-width:calc(100% - 2rem)}.post-content__read-more{margin-top:1.3rem}.post-content__read-more,.post-content a,.post-header a{color:var(--aqua2);color:var(--primary-alt)}.post-content a:hover,.post-header a:hover{color:var(--aqua1);color:var(--primary)}.post-tag:before{content:"#"}.post-heading__anchor{display:none}h1:hover .post-heading__anchor,h2:hover .post-heading__anchor,h3:hover .post-heading__anchor,h4:hover .post-heading__anchor{display:inline-block}.jr__item-meta{flex-direction:column}.jr-basics__image,.jr-basics__item,.jr-basics__profile-icon,.jr-basics__profile-item,.jr__item-meta{align-items:center;display:flex}.jr-basics__name,.jr-projects__roles,.jr-work__position{font-size:1.125rem;font-weight:700}.jr-basics__item{flex-direction:column;text-align:center}.jr-basics__item hr{margin:1.5rem auto}.jr-basics__image{border-radius:50%;height:250px;justify-content:center;overflow:hidden;width:250px}.jr-basics__description,.jr-basics__label,.jr-basics__name{margin-top:.75rem}.jr-basics__profile svg{height:24px;width:24px}.jr-basics__profile,.jr-basics__profile-item{display:flex}.jr-basics__profile-item{display:flex;padding:.2rem}.jr-basics__profile--col{flex-direction:column}.jr-basics__profile--row{flex-wrap:wrap;justify-content:space-evenly}.jr-basics__profile-icon{padding:0 .75rem}.jr__item-meta{align-items:start;flex-flow:column;font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace)}@media (min-width:768px){.jr__item-meta{align-items:center;flex-flow:row wrap}.jr-work__location,.jr__date-range{flex-grow:1;text-align:right}}#cookie-consent{-webkit-animation:fadeIn .75s;animation:fadeIn .75s;background:var(--bg);border-radius:.2rem;bottom:1rem;box-shadow:0 -.5rem 1rem var(--bg1);font-family:Fira Code,Lucida Console,Monaco,monospace;font-family:var(--font-monospace);left:1rem;padding:1rem;position:fixed;right:1rem}@media (min-width:768px){#cookie-consent{padding:2.5rem}}#cookie-consent button{background:none;border:none;color:var(--aqua2);color:var(--primary-alt);font-size:1.125rem;margin:0 1rem;white-space:nowrap}#cookie-consent button:hover{color:var(--aqua1);color:var(--primary);cursor:pointer}.cookie-consent--hidden{display:none}.cli-prompt{display:flex;justify-content:center}.cli-prompt__cursor{-webkit-animation:blink 1s infinite;animation:blink 1s infinite}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}</style>
<link rel=preload href="/css/non-critical.155ced3be007d4b3c136296f991c092874375053ed6707511d3928e521e1e391bb1f91ddb4fd02db4d9658229b36f12b9f17633d5795441362050df7014f0fec.css" as=style onload="this.onload=null,this.rel='stylesheet'" integrity="sha512-FVztO+AH1LPBNilvmRwJKHQ3UFPtZwdRHTko5SHh45G7H5HdtP0C202WWCKbNvErnxdjPVeVRBNiBQ33AU8P7A==">
<link id=prism-dark rel=prefetch href=/prism-themes/prism-gruvbox-dark.min.54aecc64074623a4f9898544dcbdab9e804f1560ef0b38f4cf8e10fcaaf72264e798cb407c601aca6ecd833ec4eb93d66535581f18d45ba202cf848b70dbc332.css as=style onload="this.onload=null,this.rel='stylesheet'" integrity="sha512-VK7MZAdGI6T5iYVE3L2rnoBPFWDvCzj0z44Q/Kr3ImTnmMtAfGAaym7Ngz7E65PWZTVYHxjUW6ICz4SLcNvDMg==">
<link id=prism-light rel=prefetch href=/prism-themes/prism-gruvbox-light.min.42a221741efe997fcc94187c39d63c555560678789ac9ca856c74a5f0ddb2aa6c50d38b2ffbecc7a99038cbbd2efa99746e862267f781c559e0cfec10b88a5fc.css as=style onload="this.onload=null,this.rel='stylesheet'" integrity="sha512-QqIhdB7+mX/MlBh8OdY8VVVgZ4eJrJyoVsdKXw3bKqbFDTiy/77MepkDjLvS76mXRuhiJn94HFWeDP7BC4il/A==" disabled>
<noscript>
<link rel=stylesheet href=/prism-themes/prism-gruvbox-dark.min.54aecc64074623a4f9898544dcbdab9e804f1560ef0b38f4cf8e10fcaaf72264e798cb407c601aca6ecd833ec4eb93d66535581f18d45ba202cf848b70dbc332.css integrity="sha512-VK7MZAdGI6T5iYVE3L2rnoBPFWDvCzj0z44Q/Kr3ImTnmMtAfGAaym7Ngz7E65PWZTVYHxjUW6ICz4SLcNvDMg==">
<link rel=stylesheet href="/css/non-critical.155ced3be007d4b3c136296f991c092874375053ed6707511d3928e521e1e391bb1f91ddb4fd02db4d9658229b36f12b9f17633d5795441362050df7014f0fec.css" integrity="sha512-FVztO+AH1LPBNilvmRwJKHQ3UFPtZwdRHTko5SHh45G7H5HdtP0C202WWCKbNvErnxdjPVeVRBNiBQ33AU8P7A==">
</noscript>
<script>(()=>{function c(){if(localStorage&&localStorage.getItem("theme"))return localStorage.getItem("theme");if(window.matchMedia)return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}function a(a){document.documentElement.setAttribute("theme",a);let b=document.getElementById("prism-dark"),c=document.getElementById("prism-light");b.toggleAttribute("disabled",a==="light"),c.toggleAttribute("disabled",a==="dark"),localStorage.setItem("theme",a)}var b=c();b&&a(b);function d(b){let c=b.currentTarget.classList.contains("light--hidden")?"light":"dark";a(c)}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".theme__toggle").forEach(a=>{a.addEventListener("click",d)})})})()</script>
<link rel=icon href=/img/favicon.svg sizes=any type=image/svg+xml>
</head>
<body>
<div class=layout>
<header>
<a class=logo href=/>
<div class=logo__text>schnerring.net</div>
<div class=logo__chevron>></div>
<div class=logo__cursor>█</div>
</a>
<div class=search>
<input id=search__text type=search placeholder=Search... aria-label=Search autocomplete=off>
<div id=search__suggestions class=search__suggestions--hidden></div>
</div>
<nav id=menu>
<ul class=menu--horizontal>
<li class=menu__item>
<a href=/posts>Blog</a>
</li>
<li class=menu__item>
<a href=/cv>CV</a>
</li>
<li class=menu__item>
<a href=/about>About</a>
</li>
</ul>
<div class=menu__burger>
<input class=menu__item type=checkbox aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/></svg>
<ul class=menu--vertical>
<li>
<a class=menu__item href=/posts>Blog</a>
</li>
<li>
<a class=menu__item href=/cv>CV</a>
</li>
<li>
<a class=menu__item href=/about>About</a>
</li>
</ul>
</div>
</nav>
<button class="theme__toggle light--hidden" aria-label="Toggle light mode"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg>
</button>
<button class="theme__toggle dark--hidden" aria-label="Toggle dark mode"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg>
</button>
</header>
<main>
<div class=content>
<article class=post>
<div class=post-header>
<h1>
<a href=/posts/set-up-azure-active-directory-domain-services-aadds-with-terraform/>Set Up Azure Active Directory Domain Services (AADDS) with Terraform</a>
</h1>
<div class=post-meta>
<span>2021-05-22</span>
<div>
<span>
<a class=post-tag href=https://schnerring.net/tags/aadds>aadds</a>
</span>
<span>
<a class=post-tag href=https://schnerring.net/tags/arm>arm</a>
</span>
<span>
<a class=post-tag href=https://schnerring.net/tags/azure-active-directory-domain-services>azure&#8209;active&#8209;directory&#8209;domain&#8209;services</a>
</span>
<span>
<a class=post-tag href=https://schnerring.net/tags/azure-resource-manager-template>azure&#8209;resource&#8209;manager&#8209;template</a>
</span>
<span>
<a class=post-tag href=https://schnerring.net/tags/terraform>terraform</a>
</span>
</div>
<img src=/posts/set-up-azure-active-directory-domain-services-aadds-with-terraform/img/cover.svg alt=Test>
</div>
</div>
<div class=post-content>
<h2 id=update-2021-08-03>
Update 2021-08-03
<a href=#update-2021-08-03 class=post-heading__anchor aria-hidden=true>#</a>
</h2>
<p>With <a href=https://github.com/terraform-providers/terraform-provider-azurerm/releases/tag/v2.69.0 class=link--external target=_blank rel=noreferrer>v2.69.0 of the official Terraform azurerm provider</a> released two weeks ago, the <a href=https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/active_directory_domain_service class=link--external target=_blank rel=noreferrer><code>active_directory_domain_service</code></a> and <a href=https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/active_directory_domain_service_replica_set class=link--external target=_blank rel=noreferrer><code>active_directory_domain_service_replica_set</code></a> resources are now available. If you are newly adding AADDS, there is no point in reading any further — use the official resources.</p>
<p>I will switch in the coming weeks and write a short migration guide for the people using my <a href=https://registry.terraform.io/modules/schnerring/aadds/azurerm/latest class=link--external target=_blank rel=noreferrer>AADDS Terraform module</a>.</p>
<hr>
<p>Bringing traditional Active Directory Domain Services (AD DS) to the cloud, typically required to set up, secure, and maintain domain controllers (DCs). Azure Active Directory Domain Services (AADDS or Azure AD DS) is a <em>Microsoft-managed</em> solution, providing a subset of <a href=https://docs.microsoft.com/en-us/azure/active-directory-domain-services/compare-identity-solutions class=link--external target=_blank rel=noreferrer>traditional AD DS features</a> without the need to <em>self-manage</em> DCs.</p>
<p>One such service that requires AD DS features is <a href=https://docs.microsoft.com/en-us/azure/virtual-desktop/overview class=link--external target=_blank rel=noreferrer>Windows Virtual Desktop (WVD)</a>. I have successfully deployed WVD with Terraform, but until recently, I struggled to do the same with AADDS. Today, I show you how to deploy AADDS with Terraform.</p>
<p>If you are lazy, you can <a href=#wrapping-up>skip to the end</a> and use the custom Terraform module <a href=https://registry.terraform.io/modules/schnerring/aadds/azurerm/latest class=link--external target=_blank rel=noreferrer>I published to the Terraform Registry</a>.</p>
<h2 id=prerequisites>
Prerequisites
<a href=#prerequisites class=post-heading__anchor aria-hidden=true>#</a>
</h2>
<p>Before getting started, we need the following things:</p>
<ul>
<li>Active Azure subscription</li>
<li><a href=https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-create-new-tenant class=link--external target=_blank rel=noreferrer>Azure Active Directory (Azure AD or AAD) tenant</a></li>
<li><a href=https://www.terraform.io/downloads.html class=link--external target=_blank rel=noreferrer>Install Terraform</a></li>
</ul>
<h2 id=building-blocks>
Building Blocks
<a href=#building-blocks class=post-heading__anchor aria-hidden=true>#</a>
</h2>
<p>So how do we figure out what the required resources are to deploy AADDS? By reverse-engineering the AADDS configuration wizard in the Azure Portal! We launch it by adding a new managed domain after navigating to <strong>Azure AD Domain Services</strong>.</p>
<p>What we find is that the following resources are required:</p>
<ul>
<li>Resource group</li>
<li>Virtual network and subnet</li>
<li><code>AAD DC Administrators</code> user group</li>
</ul>
<p>Using default values for the remaining configuration options, we can download an <a href=https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview class=link--external target=_blank rel=noreferrer>Azure Resource Manager (ARM) template</a> in the final review step of the wizard.</p>
<p>Analyzing the ARM template reveals that besides the resource group, virtual network, and subnet, a <a href=https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview class=link--external target=_blank rel=noreferrer>Network Security Group (NSG)</a> with the <a href=https://docs.microsoft.com/en-us/azure/active-directory-domain-services/alert-nsg#inbound-security-rules class=link--external target=_blank rel=noreferrer>security rules required for AADDS</a> is added.</p>
<p>The ARM template also contains the <code>Microsoft.AAD/domainServices</code> resource, with its parameters set to the configuration options from the wizard. The following is version <code>2021-03-01</code> of the ARM template format <a href="https://docs.microsoft.com/en-us/azure/templates/microsoft.aad/2021-03-01/domainservices?tabs=json" class=link--external target=_blank rel=noreferrer>from the official Azure Template documentation</a>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;Microsoft.AAD/domainServices&#34;</span>,
  <span style=color:#f92672>&#34;apiVersion&#34;</span>: <span style=color:#e6db74>&#34;2021-03-01&#34;</span>,
  <span style=color:#f92672>&#34;location&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
  <span style=color:#f92672>&#34;tags&#34;</span>: {},
  <span style=color:#f92672>&#34;properties&#34;</span>: {
    <span style=color:#f92672>&#34;domainName&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
    <span style=color:#f92672>&#34;replicaSets&#34;</span>: [
      {
        <span style=color:#f92672>&#34;location&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
        <span style=color:#f92672>&#34;subnetId&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>
      }
    ],
    <span style=color:#f92672>&#34;ldapsSettings&#34;</span>: {
      <span style=color:#f92672>&#34;ldaps&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
      <span style=color:#f92672>&#34;pfxCertificate&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
      <span style=color:#f92672>&#34;pfxCertificatePassword&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
      <span style=color:#f92672>&#34;externalAccess&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>
    },
    <span style=color:#f92672>&#34;resourceForestSettings&#34;</span>: {
      <span style=color:#f92672>&#34;settings&#34;</span>: [
        {
          <span style=color:#f92672>&#34;trustedDomainFqdn&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
          <span style=color:#f92672>&#34;trustDirection&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
          <span style=color:#f92672>&#34;friendlyName&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
          <span style=color:#f92672>&#34;remoteDnsIps&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
          <span style=color:#f92672>&#34;trustPassword&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>
        }
      ],
      <span style=color:#f92672>&#34;resourceForest&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>
    },
    <span style=color:#f92672>&#34;domainSecuritySettings&#34;</span>: {
      <span style=color:#f92672>&#34;ntlmV1&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
      <span style=color:#f92672>&#34;tlsV1&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
      <span style=color:#f92672>&#34;syncNtlmPasswords&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
      <span style=color:#f92672>&#34;syncKerberosPasswords&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
      <span style=color:#f92672>&#34;syncOnPremPasswords&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
      <span style=color:#f92672>&#34;kerberosRc4Encryption&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
      <span style=color:#f92672>&#34;kerberosArmoring&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>
    },
    <span style=color:#f92672>&#34;domainConfigurationType&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
    <span style=color:#f92672>&#34;sku&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
    <span style=color:#f92672>&#34;filteredSync&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
    <span style=color:#f92672>&#34;notificationSettings&#34;</span>: {
      <span style=color:#f92672>&#34;notifyGlobalAdmins&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
      <span style=color:#f92672>&#34;notifyDcAdmins&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
      <span style=color:#f92672>&#34;additionalRecipients&#34;</span>: [<span style=color:#e6db74>&#34;string&#34;</span>]
    }
  }
}
</code></pre></div><p>The docs also reference the <a href=https://github.com/Azure/azure-quickstart-templates/tree/master/101-AAD-DomainServices class=link--external target=_blank rel=noreferrer>Azure Resource Manager QuickStart Template on GitHub</a>. Its README confirms our previous findings but shows that the configuration wizard also must perform the following steps under the hood:</p>
<ul>
<li><a href=https://github.com/Azure/azure-quickstart-templates/tree/820b8b7c172d08d0966b0c6f4a80691ca1972410/101-AAD-DomainServices#3-register-the-azure-active-directory-application-service-principal class=link--external target=_blank rel=noreferrer>Register the Azure Active Directory Application Service Principal <code>2565bd9d-da50-47d4-8b85-4c97f669dc36</code></a></li>
<li><a href=https://github.com/Azure/azure-quickstart-templates/tree/820b8b7c172d08d0966b0c6f4a80691ca1972410/101-AAD-DomainServices#5-register-resource-provider class=link--external target=_blank rel=noreferrer>Register the <code>Microsoft.AAD</code> Resource Provider</a></li>
</ul>
<p>With everything figured out, we can continue with the fun part: Terraform!</p>
<h2 id=putting-everything-together>
Putting Everything Together
<a href=#putting-everything-together class=post-heading__anchor aria-hidden=true>#</a>
</h2>
<p>Let&rsquo;s register the service principal and resource provider first:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azuread_service_principal&#34; &#34;aadds&#34;</span> {
  application_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2565bd9d-da50-47d4-8b85-4c97f669dc36&#34;</span>
}

<span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_resource_provider_registration&#34; &#34;aadds&#34;</span> {
  name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Microsoft.AAD&#34;</span>
}
</code></pre></div><p>Next, we add the <code>AAD DC Administrators</code> user group:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azuread_group&#34; &#34;aadds&#34;</span> {
  display_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AAD DC Administrators&#34;</span>
  description  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Delegated group to administer Azure AD Domain Services&#34;</span>
}
</code></pre></div><p>Adding the resource group, virtual network, subnet, and NSG is pretty straightforward:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_resource_group&#34; &#34;aadds&#34;</span> {
  name     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-rg&#34;</span>
  location <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>
}

<span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_virtual_network&#34; &#34;aadds&#34;</span> {
  name                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-vnet&#34;</span>
  resource_group_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
  location            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>

  address_space <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;10.0.0.0/16&#34;</span>]<span style=color:#75715e>
</span><span style=color:#75715e>
</span><span style=color:#75715e>  # AADDS DCs
</span><span style=color:#75715e></span>  dns_servers <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;10.0.0.4&#34;, &#34;10.0.0.5&#34;</span>]
}

<span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_subnet&#34; &#34;aadds&#34;</span> {
  name                 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-snet&#34;</span>
  resource_group_name  <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
  virtual_network_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_virtual_network</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>

  address_prefixes <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;10.0.0.0/24&#34;</span>]
}

<span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_network_security_group&#34; &#34;aadds&#34;</span> {
  name                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-nsg&#34;</span>
  location            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>
  resource_group_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>

  <span style=color:#66d9ef>security_rule</span> {
    name                       <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AllowRD&#34;</span>
    access                     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Allow&#34;</span>
    priority                   <span style=color:#f92672>=</span> <span style=color:#ae81ff>201</span>
    direction                  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Inbound&#34;</span>
    protocol                   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Tcp&#34;</span>
    source_address_prefix      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;CorpNetSaw&#34;</span>
    source_port_range          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*&#34;</span>
    destination_address_prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*&#34;</span>
    destination_port_range     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;3389&#34;</span>
  }

  <span style=color:#66d9ef>security_rule</span> {
    name                       <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AllowPSRemoting&#34;</span>
    access                     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Allow&#34;</span>
    priority                   <span style=color:#f92672>=</span> <span style=color:#ae81ff>301</span>
    direction                  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Inbound&#34;</span>
    protocol                   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Tcp&#34;</span>
    source_address_prefix      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AzureActiveDirectoryDomainServices&#34;</span>
    source_port_range          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*&#34;</span>
    destination_address_prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*&#34;</span>
    destination_port_range     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;5986&#34;</span>
  }
}

<span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_subnet_network_security_group_association&#34; &#34;aadds&#34;</span> {
  subnet_id                 <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_subnet</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>id</span>
  network_security_group_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_network_security_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>id</span>
}
</code></pre></div><p>Make sure to set <code>dns_servers</code> to the IP addresses of the DCs. You can find them on the <strong>Overview</strong> page of the managed domain after the deployment succeeded.</p>
<p>The final step is to add the AADDS deployment. Define the ARM template as Terraform <a href=https://www.terraform.io/docs/language/functions/templatefile.html class=link--external target=_blank rel=noreferrer><code>templatefile</code></a> named <code>aadds-arm-template.tpl.json</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;$schema&#34;</span>: <span style=color:#e6db74>&#34;https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;</span>,
  <span style=color:#f92672>&#34;contentVersion&#34;</span>: <span style=color:#e6db74>&#34;1.0.0.0&#34;</span>,
  <span style=color:#f92672>&#34;resources&#34;</span>: [
    {
      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;${domainName}&#34;</span>,
      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;Microsoft.AAD/domainServices&#34;</span>,
      <span style=color:#f92672>&#34;apiVersion&#34;</span>: <span style=color:#e6db74>&#34;2021-03-01&#34;</span>,
      <span style=color:#f92672>&#34;location&#34;</span>: <span style=color:#e6db74>&#34;${location}&#34;</span>,
      <span style=color:#f92672>&#34;tags&#34;</span>: <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#960050;background-color:#1e0010>tags</span>},
      <span style=color:#f92672>&#34;properties&#34;</span>: {
        <span style=color:#f92672>&#34;domainName&#34;</span>: <span style=color:#e6db74>&#34;${domainName}&#34;</span>,
        <span style=color:#f92672>&#34;replicaSets&#34;</span>: [
          {
            <span style=color:#f92672>&#34;location&#34;</span>: <span style=color:#e6db74>&#34;${location}&#34;</span>,
            <span style=color:#f92672>&#34;subnetId&#34;</span>: <span style=color:#e6db74>&#34;${subnetId}&#34;</span>
          }
        ],
        <span style=color:#f92672>&#34;domainSecuritySettings&#34;</span>: {
          <span style=color:#f92672>&#34;ntlmV1&#34;</span>: <span style=color:#e6db74>&#34;${ntlmV1}&#34;</span>,
          <span style=color:#f92672>&#34;tlsV1&#34;</span>: <span style=color:#e6db74>&#34;${tlsV1}&#34;</span>,
          <span style=color:#f92672>&#34;syncNtlmPasswords&#34;</span>: <span style=color:#e6db74>&#34;${syncNtlmPasswords}&#34;</span>,
          <span style=color:#f92672>&#34;syncKerberosPasswords&#34;</span>: <span style=color:#e6db74>&#34;${syncKerberosPasswords}&#34;</span>,
          <span style=color:#f92672>&#34;syncOnPremPasswords&#34;</span>: <span style=color:#e6db74>&#34;${syncOnPremPasswords}&#34;</span>,
          <span style=color:#f92672>&#34;kerberosRc4Encryption&#34;</span>: <span style=color:#e6db74>&#34;${kerberosRc4Encryption}&#34;</span>,
          <span style=color:#f92672>&#34;kerberosArmoring&#34;</span>: <span style=color:#e6db74>&#34;${kerberosArmoring}&#34;</span>
        },
        <span style=color:#f92672>&#34;domainConfigurationType&#34;</span>: <span style=color:#e6db74>&#34;${domainConfigurationType}&#34;</span>,
        <span style=color:#f92672>&#34;sku&#34;</span>: <span style=color:#e6db74>&#34;${sku}&#34;</span>,
        <span style=color:#f92672>&#34;filteredSync&#34;</span>: <span style=color:#e6db74>&#34;${filteredSync}&#34;</span>,
        <span style=color:#f92672>&#34;notificationSettings&#34;</span>: {
          <span style=color:#f92672>&#34;notifyGlobalAdmins&#34;</span>: <span style=color:#e6db74>&#34;${notifyGlobalAdmins}&#34;</span>,
          <span style=color:#f92672>&#34;notifyDcAdmins&#34;</span>: <span style=color:#e6db74>&#34;${notifyDcAdmins}&#34;</span>,
          <span style=color:#f92672>&#34;additionalRecipients&#34;</span>: <span style=color:#960050;background-color:#1e0010>$</span>{<span style=color:#960050;background-color:#1e0010>additionalRecipients</span>}
        }
      }
    }
  ]
}
</code></pre></div><p>We then populate its values dynamically like so:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_resource_group_template_deployment&#34; &#34;aadds&#34;</span> {
  name                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-deploy&#34;</span>
  resource_group_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>

  deployment_mode <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Incremental&#34;</span>

  template_content <span style=color:#f92672>=</span> <span style=color:#66d9ef>templatefile</span>(
    <span style=color:#e6db74>&#34;${path.module}/aadds-arm-template.tpl.json&#34;</span>,
    {<span style=color:#75715e>
</span><span style=color:#75715e>      # Basics
</span><span style=color:#75715e></span>      &#34;domainName&#34;              <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds.schnerring.net&#34;</span>
      &#34;location&#34;                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>
      &#34;sku&#34;                     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Standard&#34;</span>
      &#34;domainConfigurationType&#34; <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;FullySynced&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e>
</span><span style=color:#75715e>      # Networking
</span><span style=color:#75715e></span>      &#34;subnetId&#34; <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_subnet</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>id</span><span style=color:#75715e>
</span><span style=color:#75715e>
</span><span style=color:#75715e>      # Administration
</span><span style=color:#75715e></span>      &#34;notifyGlobalAdmins&#34;   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
      &#34;notifyDcAdmins&#34;       <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
      &#34;additionalRecipients&#34; <span style=color:#f92672>=</span> <span style=color:#66d9ef>jsonencode</span>([])<span style=color:#75715e>
</span><span style=color:#75715e>
</span><span style=color:#75715e>      # Synchronization
</span><span style=color:#75715e></span>      &#34;filteredSync&#34; <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e>
</span><span style=color:#75715e>      # Security
</span><span style=color:#75715e></span>      &#34;tlsV1&#34;                 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
      &#34;ntlmV1&#34;                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
      &#34;syncNtlmPasswords&#34;     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
      &#34;syncOnPremPasswords&#34;   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
      &#34;kerberosRc4Encryption&#34; <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
      &#34;syncKerberosPasswords&#34; <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enabled&#34;</span>
      &#34;kerberosArmoring&#34;      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Disabled&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e>
</span><span style=color:#75715e>      # Tags
</span><span style=color:#75715e></span>      &#34;tags&#34; <span style=color:#f92672>=</span> <span style=color:#66d9ef>jsonencode</span>({})
    }
  )

  depends_on <span style=color:#f92672>=</span> [<span style=color:#66d9ef>azurerm_resource_provider_registration</span>.<span style=color:#66d9ef>aadds</span>]
}
</code></pre></div><p>Run <code>terraform apply</code> to deploy everything. It takes around 45 minutes to complete.</p>
<h2 id=wrapping-up>
Wrapping Up
<a href=#wrapping-up class=post-heading__anchor aria-hidden=true>#</a>
</h2>
<p>I created a custom module wrapping the above functionality and <a href=https://registry.terraform.io/modules/schnerring/aadds/azurerm/latest class=link--external target=_blank rel=noreferrer>published it to the Terraform Registry</a>. You can also find <a href=https://github.com/schnerring/terraform-azurerm-aadds class=link--external target=_blank rel=noreferrer>the code on my GitHub</a> along with some examples. I decided that the creation of network resources is out of the module&rsquo;s scope. Depending on what network topology you prefer, pre-provisioning the virtual network and subnet gives you more flexibility.</p>
<p>The module provides the same options as the Azure Portal configuration wizard. More advanced configuration options like LDAP and forests are not yet supported. Feel free to comment below, or open an issue or pull request on GitHub if you find something to improve.</p>
<p>A minimal deployment with the custom module looks like this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_resource_group&#34; &#34;aadds&#34;</span> {
  name     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-rg&#34;</span>
  location <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>
}

<span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_virtual_network&#34; &#34;aadds&#34;</span> {
  name                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-vnet&#34;</span>
  resource_group_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
  location            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>

  address_space <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;10.0.0.0/16&#34;</span>]<span style=color:#75715e>
</span><span style=color:#75715e>
</span><span style=color:#75715e>  # AADDS DCs
</span><span style=color:#75715e></span>  dns_servers <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;10.0.0.4&#34;, &#34;10.0.0.5&#34;</span>]
}

<span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_subnet&#34; &#34;aadds&#34;</span> {
  name                 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds-snet&#34;</span>
  resource_group_name  <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
  virtual_network_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_virtual_network</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>

  address_prefixes <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;10.0.0.0/24&#34;</span>]
}

<span style=color:#66d9ef>module</span> <span style=color:#e6db74>&#34;aadds&#34;</span> {
  source  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;schnerring/aadds/azurerm&#34;</span>
  version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.1.1&#34;</span>

  resource_group_name <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_resource_group</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>name</span>
  location            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Switzerland North&#34;</span>
  domain_name         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aadds.schnerring.net&#34;</span>
  subnet_id           <span style=color:#f92672>=</span> <span style=color:#66d9ef>azurerm_subnet</span>.<span style=color:#66d9ef>aadds</span>.<span style=color:#66d9ef>id</span>
}
</code></pre></div>
</div>
<div id=remark42></div>
<script>var remark_config={host:"https://remark42.schnerring.net",site_id:"schnerring.net",theme:localStorage.getItem("theme"),show_email_subscription:!1}</script>
<script>!function(d,b){for(var c=0,a,e,f;c<d.length;c++)a=b.createElement("script"),e=".js",f=b.head||b.body,"noModule"in a?(a.type="module",e=".mjs"):a.async=!0,a.defer=!0,a.src=remark_config.host+"/web/"+d[c]+e,f.appendChild(a)}(remark_config.components||["embed"],document)</script>
<script>const themeToggleLight=document.getElementsByClassName("theme__toggle light--hidden").item(0);themeToggleLight.addEventListener("click",()=>{setTimeout(()=>window.REMARK42.changeTheme("light"),10)});const themeToggleDark=document.getElementsByClassName("theme__toggle dark--hidden").item(0);themeToggleDark.addEventListener("click",()=>{setTimeout(()=>window.REMARK42.changeTheme("dark"),10)})</script>
<script>function cookieConsentClick(){localStorage.setItem("cookie-consent",!0);const a=document.getElementById("cookie-consent");a.classList.add("cookie-consent--hidden")}</script>
<div id=cookie-consent class=cookie-consent--hidden>
<div class=cli-prompt>
<div class=cli-prompt__chevron>>&nbsp;</div>
<div class=cli-prompt__text>
<span>When you participate in the comments, a cookie is used to keep you logged in.</span>
<span class=cli-prompt__cursor>█</span>
</div>
<button onclick=cookieConsentClick()>Got it!</button>
</div>
</div>
<script>const cookieConsentAccepted=localStorage&&localStorage.getItem("cookie-consent");if(!cookieConsentAccepted){const a=document.getElementById("cookie-consent");a.classList.remove("cookie-consent--hidden")}</script>
</article>
</div>
<div class=sidebar>
<aside class=bio>
<section class="jr__item jr-basics__item">
<div class=jr-basics__image>
<img src=https://schnerring.net/michael-schnerring.jpg alt="Picture of Michael Schnerring" width=250 height=250>
</div>
<div class=jr-basics__name>Michael Schnerring</div>
<div class=jr-basics__label>Software Engineer</div>
<div class=jr-basics__description>I've been a computer geek all my life. I'm passionate about open-source and digital privacy. I like video games and CrossFit. I'm also terrible at blogging.</div>
<hr>
<div class="jr-basics__profile jr-basics__profile--col">
<a href=https://github.com/schnerring>
<div class=jr-basics__profile-item>
<div class=jr-basics__profile-icon><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
</div>
<div class=jr-basics__profile-username>schnerring</div>
</div>
</a>
<div class=jr-basics__profile-item>
<div class=jr-basics__profile-icon><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Matrix</title><path d="M.632.55v22.9H2.28V24H0V0h2.28v.55zm7.043 7.26v1.157h.033c.309-.443.683-.784 1.117-1.024.433-.245.936-.365 1.5-.365.54.0 1.033.107 1.481.314.448.208.785.582 1.02 1.108.254-.374.6-.706 1.034-.992.434-.287.95-.43 1.546-.43.453.0.872.056 1.26.167.388.11.716.286.993.53.276.245.489.559.646.951.152.392.23.863.23 1.417v5.728h-2.349V11.52c0-.286-.01-.559-.032-.812a1.755 1.755.0 00-.18-.66 1.106 1.106.0 00-.438-.448c-.194-.11-.457-.166-.785-.166-.332.0-.6.064-.803.189a1.38 1.38.0 00-.48.499 1.946 1.946.0 00-.231.696 5.56 5.56.0 00-.06.785v4.768h-2.35v-4.8c0-.254-.004-.503-.018-.752a2.074 2.074.0 00-.143-.688 1.052 1.052.0 00-.415-.503c-.194-.125-.476-.19-.854-.19-.111.0-.259.024-.439.074-.18.051-.36.143-.53.282-.171.138-.319.337-.439.595-.12.259-.18.6-.18 1.02v4.966H5.46V7.81zm15.693 15.64V.55H21.72V0H24v24h-2.28v-.55z"/></svg>
</div>
<div class=jr-basics__profile-username>@michael:schnerring.net</div>
</div>
</div>
<hr>
<div class="jr-basics__profile jr-basics__profile--row">
<a href=https://www.linkedin.com/in/schnerring>
<div class=jr-basics__profile-item>
<div class=jr-basics__profile-icon><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg>
</div>
</div>
</a>
<a href=https://twitter.com/schnerringo>
<div class=jr-basics__profile-item>
<div class=jr-basics__profile-icon><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958.0 002.163-2.723c-.951.555-2.005.959-3.127 1.184A4.92 4.92.0 0011.78 8.288C7.69 8.095 4.067 6.13 1.64 3.162A4.822 4.822.0 00.974 5.637c0 1.71.87 3.213 2.188 4.096A4.904 4.904.0 01.934 9.117v.06a4.923 4.923.0 003.946 4.827 4.996 4.996.0 01-2.212.085 4.936 4.936.0 004.604 3.417A9.867 9.867.0 011.17 19.611c-.39.0-.779-.023-1.17-.067a13.995 13.995.0 007.557 2.209c9.053.0 13.998-7.496 13.998-13.985.0-.21.0-.42-.015-.63A9.935 9.935.0 0024 4.59z"/></svg>
</div>
</div>
</a>
<a href=https://stackoverflow.com/users/1154965/michael-schnerring>
<div class=jr-basics__profile-item>
<div class=jr-basics__profile-icon><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Stack Overflow</title><path d="M15.725.0l-1.72 1.277 6.39 8.588 1.716-1.277L15.725.0zm-3.94 3.418-1.369 1.644 8.225 6.85 1.369-1.644-8.225-6.85zm-3.15 4.465-.905 1.94 9.702 4.517.904-1.94-9.701-4.517zm-1.85 4.86-.44 2.093 10.473 2.201.44-2.092-10.473-2.203zM1.89 15.47V24h19.19v-8.53h-2.133v6.397H4.021v-6.396H1.89zm4.265 2.133v2.13h10.66v-2.13H6.154z"/></svg>
</div>
</div>
</a>
</div>
</section>
</aside>
</div>
</main>
<footer>
<div class=copyright>
<p>Copyright © 2020 Michael Schnerring</p><p xmlns:dct=http://purl.org/dc/terms/ xmlns:cc=http://creativecommons.org/ns# class=license-text><a rel=cc:attributionurl property="dct:title" href=https://github.com/schnerring/schnerring.github.io/tree/main/content>Content</a> licensed under <a rel=license href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a></p>
</div>
</footer>
<script type=text/javascript src=/js/main.07941426570c3f29ce826eb3a40437438c08ed970d117f62cfd361ba175908c57b2c2b7c68c33ca90f1f364a94dd11114c147f94a4967aa1d460f5e24087751e.js integrity="sha512-B5QUJlcMPynOgm6zpAQ3Q4wI7ZcNEX9iz9NhuhdZCMV7LCt8aMM8qQ8fNkqU3RERTBR/lKSWeqHUYPXiQId1Hg=="></script>
<script type=text/javascript src=/js/flexsearch.06d3e66272d74643747d92262cb4e9d99fefa25672d96593e26b0a642cf52ce00ce2ca3ade6257b765a9aae3b99f50b326c8a6115dd70c285669655d35a29843.js integrity="sha512-BtPmYnLXRkN0fZImLLTp2Z/volZy2WWT4msKZCz1LOAM4so63mJXt2WpquO5n1CzJsimEV3XDChWaWVdNaKYQw=="></script>
</div>
</body>
</html>